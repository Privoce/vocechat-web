"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var prosemirrorState=require("prosemirror-state"),prosemirrorTransform=require("prosemirror-transform"),InputRule=_createClass((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.match=t,this.match=t,this.handler="string"==typeof n?stringHandler(n):n,this.undoable=!1!==r.undoable,this.inCode=r.inCode||!1}));function stringHandler(e){return function(t,n,r,o){var u=e;if(n[1]){var i=n[0].lastIndexOf(n[1]);u+=n[0].slice(i+n[1].length);var l=(r+=i)-o;l>0&&(u=n[0].slice(i-l,i)+u,r=o)}return t.tr.insertText(u,r,o)}}var MAX_MATCH=500;function inputRules(e){var t=e.rules,n=new prosemirrorState.Plugin({state:{init:function(){return null},apply:function(e,t){var n=e.getMeta(this);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:function(e,r,o,u){return run(e,r,o,u,t,n)},handleDOMEvents:{compositionend:function(e){setTimeout((function(){var r=e.state.selection.$cursor;r&&run(e,r.pos,r.pos,"",t,n)}))}}},isInputRules:!0});return n}function run(e,t,n,r,o,u){if(e.composing)return!1;for(var i=e.state,l=i.doc.resolve(t),s=l.parent.textBetween(Math.max(0,l.parentOffset-MAX_MATCH),l.parentOffset,null,"\ufffc")+r,p=0;p<o.length;p++){var a=o[p];if(l.parent.type.spec.code){if(!a.inCode)continue}else if("only"===a.inCode)continue;var c=a.match.exec(s),f=c&&a.handler(i,c,t-(c[0].length-r.length),n);if(f)return a.undoable&&f.setMeta(u,{transform:f,from:t,to:n,text:r}),e.dispatch(f),!0}return!1}var undoInputRule=function(e,t){for(var n=e.plugins,r=0;r<n.length;r++){var o=n[r],u=void 0;if(o.spec.isInputRules&&(u=o.getState(e))){if(t){for(var i=e.tr,l=u.transform,s=l.steps.length-1;s>=0;s--)i.step(l.steps[s].invert(l.docs[s]));if(u.text){var p=i.doc.resolve(u.from).marks();i.replaceWith(u.from,u.to,e.schema.text(u.text,p))}else i.delete(u.from,u.to);t(i)}return!0}}return!1},emDash=new InputRule(/--$/,"\u2014"),ellipsis=new InputRule(/\.\.\.$/,"\u2026"),openDoubleQuote=new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201c"),closeDoubleQuote=new InputRule(/"$/,"\u201d"),openSingleQuote=new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),closeSingleQuote=new InputRule(/'$/,"\u2019"),smartQuotes=[openDoubleQuote,closeDoubleQuote,openSingleQuote,closeSingleQuote];function wrappingInputRule(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return new InputRule(e,(function(e,o,u,i){var l=n instanceof Function?n(o):n,s=e.tr.delete(u,i),p=s.doc.resolve(u).blockRange(),a=p&&prosemirrorTransform.findWrapping(p,t,l);if(!a)return null;s.wrap(p,a);var c=s.doc.resolve(u-1).nodeBefore;return c&&c.type==t&&prosemirrorTransform.canJoin(s.doc,u-1)&&(!r||r(o,c))&&s.join(u-1),s}))}function textblockTypeInputRule(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new InputRule(e,(function(e,r,o,u){var i=e.doc.resolve(o),l=n instanceof Function?n(r):n;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t)?e.tr.delete(o,u).setBlockType(o,o,t,l):null}))}exports.InputRule=InputRule,exports.closeDoubleQuote=closeDoubleQuote,exports.closeSingleQuote=closeSingleQuote,exports.ellipsis=ellipsis,exports.emDash=emDash,exports.inputRules=inputRules,exports.openDoubleQuote=openDoubleQuote,exports.openSingleQuote=openSingleQuote,exports.smartQuotes=smartQuotes,exports.textblockTypeInputRule=textblockTypeInputRule,exports.undoInputRule=undoInputRule,exports.wrappingInputRule=wrappingInputRule;