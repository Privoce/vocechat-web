"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[577],{577:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Z});var l=n(64131),a=n(79574),i=n(26634),t=n(68812),c=n(25293),d=n(64241),r=n(51612);function o(e){const s=(0,t.GV)((e=>{var s;return null===(s=e.authData.user)||void 0===s?void 0:s.uid}),r.bN),n=(0,t.GV)((s=>s.channels.byId[e]),r.bN),[l,{isLoading:a,isSuccess:i}]=(0,d.t1)(),[c,{isLoading:o,isSuccess:u}]=(0,d.Ss)(),m=s==(null===n||void 0===n?void 0:n.owner);return{otherMembers:(null===n||void 0===n?void 0:n.members.filter((e=>e!=s)))||[],transferOwner:s=>{s&&l({id:e,owner:s})},leaveChannel:()=>{e&&c(e)},leaving:o,leaveSuccess:u,isOwner:m,transferring:a,transferSuccess:i}}var u=n(1393),m=n(77338),h=n(45891),v=n(82979);const x=({id:e,closeModal:s,handleNextStep:n})=>{const{t:t}=(0,a.Bd)("setting"),d=(0,i.Zp)(),{isOwner:r,leaving:x,leaveChannel:p,leaveSuccess:f}=o(e);return(0,l.useEffect)((()=>{f&&(c.Ay.success("Leave channel successfully!"),s(),d("/chat"))}),[f]),e?(0,v.jsx)(u.A,{id:"modal-modal",children:(0,v.jsx)(h.A,{compact:!0,title:t("channel.leave"),description:t(r?"channel.transfer_desc":"channel.leave_desc"),buttons:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(m.A,{onClick:s.bind(null,void 0),className:"cancel",children:t("action.cancel",{ns:"common"})}),r?(0,v.jsx)(m.A,{onClick:n,className:"main",children:"Next"}):(0,v.jsx)(m.A,{onClick:p,className:"danger",children:x?"Leaving":"Leave"})]})})}):null};var p=n(22404),f=n(24693);const g=({id:e,closeModal:s,withLeave:n=!0})=>{const{t:t}=(0,a.Bd)(),{transferOwner:d,otherMembers:r,leaving:x,leaveChannel:g,leaveSuccess:_,transferSuccess:j,transferring:b}=o(e),[A,y]=(0,l.useState)(null),w=(0,i.Zp)(),N=e=>{y(e)};if((0,l.useEffect)((()=>{j&&_&&(c.Ay.success("Leave channel successfully!"),s(),w("/chat"))}),[_,j,n]),!e)return null;const S=x||b;return(0,v.jsx)(u.A,{id:"modal-modal",children:(0,v.jsx)(h.A,{compact:!0,title:"Transfer Ownership",description:"This cannot be undone.",buttons:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(m.A,{onClick:s.bind(null,void 0),className:"cancel",children:t("action.cancel")}),(0,v.jsx)(m.A,{disabled:!A,onClick:async()=>{A&&(await d(A),n&&await g())},className:"danger",children:S?"Assigning":"Assign and Leave"})]}),children:(0,v.jsx)("ul",{className:"flex flex-col max-h-[260px] py-4 overflow-y-scroll",children:r.map((e=>(0,v.jsx)("li",{className:(0,p.A)("cursor-pointer flex items-center px-2 md:hover:bg-gray-500/10",A==e?"bg-gray-500/10":""),onClick:N.bind(null,e),children:(0,v.jsx)(f.A,{uid:e,interactive:!1})},e)))})})})},_=({id:e,isOwner:s=!1,closeModal:n})=>{const[a,i]=(0,l.useState)(s);return a?(0,v.jsx)(g,{id:e,closeModal:n}):(0,v.jsx)(x,{id:e,closeModal:n,handleNextStep:()=>{i(!0)}})};var j=n(50924),b=n(10330),A=n(96996),y=n(23108),w=n(65368),N=n(6696),S=n(91428),C=n(91682),k=n(74385),B=n(94784),E=n(19963),M=n(38219);const F=({id:e,show_email:s})=>{const{t:n}=(0,a.Bd)("setting",{keyPrefix:"channel"}),{t:i}=(0,a.Bd)(),[t]=(0,d.h3)(),[r,{isSuccess:o}]=(0,d.t1)();(0,l.useEffect)((()=>{o&&(t(e),c.Ay.success(i("tip.update")))}),[o,e]);return(0,v.jsx)(M.A,{title:n("show_email"),desc:"",children:(0,v.jsx)(k.A,{options:[n("enable"),n("disable")],values:["true","false"],value:`${s}`,onChange:s=>{r({id:e,show_email:"true"==s})}})})},L=({id:e,dm_to_member:s})=>{const{t:n}=(0,a.Bd)("setting",{keyPrefix:"channel"}),{t:i}=(0,a.Bd)(),[t]=(0,d.h3)(),[r,{isSuccess:o}]=(0,d.t1)();(0,l.useEffect)((()=>{o&&(t(e),c.Ay.success(i("tip.update")))}),[o,e]);return(0,v.jsx)(M.A,{title:n("dm_to_member"),desc:"",children:(0,v.jsx)(k.A,{options:[n("allow"),n("disallow")],values:["true","false"],value:`${s}`,onChange:s=>{r({id:e,dm_to_member:"true"==s})}})})},G=({id:e,add_friend:s})=>{const{t:n}=(0,a.Bd)("setting",{keyPrefix:"channel"}),{t:i}=(0,a.Bd)(),[t]=(0,d.h3)(),[r,{isSuccess:o}]=(0,d.t1)();(0,l.useEffect)((()=>{o&&(t(e),c.Ay.success(i("tip.update")))}),[o,e]);return(0,v.jsx)(M.A,{title:n("add_friend"),desc:"",children:(0,v.jsx)(k.A,{options:[n("allow"),n("disallow")],values:["true","false"],value:`${s}`,onChange:s=>{r({id:e,add_friend:"true"==s})}})})};var V=n(15676);const D=({id:e,only_owner_can_send_msg:s})=>{const{t:n}=(0,a.Bd)("setting",{keyPrefix:"channel"}),{t:i}=(0,a.Bd)(),[t]=(0,d.h3)(),[r,{isSuccess:o}]=(0,d.t1)();(0,l.useEffect)((()=>{o&&(t(e),c.Ay.success(i("tip.update")))}),[o,e]);return(0,v.jsx)(M.A,{title:n("only_owner"),desc:"",children:(0,v.jsx)(k.A,{options:[n("enable"),n("disable")],values:["true","false"],value:`${s}`,onChange:s=>{r({id:e,only_owner_can_send_msg:"true"==s})}})})};function P({id:e=0}){const{t:s}=(0,a.Bd)("setting",{keyPrefix:"channel"}),{t:n}=(0,a.Bd)(),i=(0,t.GV)((e=>e.authData.user),r.bN),o=(0,t.GV)((s=>s.channels.byId[e]),r.bN),{data:u,refetch:m}=(0,d.pc)(e),[h,x]=(0,l.useState)(!1),[p,f]=(0,l.useState)(),[g]=(0,d.ZJ)(),[_,{isSuccess:j}]=(0,d.t1)(),[b,{isSuccess:A}]=(0,d.qg)(),y=e=>{const s=e.target.value,{type:n=""}=e.target.dataset;f((e=>e?{...e,[n]:s}:e))};if((0,l.useEffect)((()=>{u&&f(u)}),[u]),(0,l.useEffect)((()=>{if(u&&p){const{name:e,description:s}=p,{name:n,description:l}=u;x(n!==e||l!==s)}}),[u,p]),(0,l.useEffect)((()=>{j&&(c.Ay.success(n("tip.update")),m())}),[j]),(0,l.useEffect)((()=>{A&&c.Ay.success(n("tip.update"))}),[A]),!p||!e||!o)return null;const{name:M,description:P,show_email:O,dm_to_member:I,add_friend:Z,only_owner_can_send_msg:$}=p,H=!(null!==i&&void 0!==i&&i.is_admin)&&(null===o||void 0===o?void 0:o.owner)!=(null===i||void 0===i?void 0:i.uid),T="w-full flex flex-col items-start gap-2 relative";return(0,v.jsxs)("div",{className:"relative w-[512px] flex flex-col gap-6 h-full mb-10",children:[(0,v.jsx)(w.A,{type:"channel",url:null===o||void 0===o?void 0:o.icon,name:M,uploadImage:s=>{g({gid:e,image:s})}}),(0,v.jsxs)("div",{className:"flex flex-col gap-6 items-start",children:[(0,v.jsxs)("div",{className:"flex items-center gap-1",children:[(0,v.jsx)(C.A,{htmlFor:"name",children:s("id")}),(0,v.jsxs)("span",{className:"text-gray-500",children:["#",e]})]}),(0,v.jsxs)("div",{className:T,children:[(0,v.jsx)(C.A,{htmlFor:"name",children:s("name")}),(0,v.jsx)(S.A,{disabled:H,className:"!pl-8","data-type":"name",onChange:y,value:M,name:"name",id:"name",placeholder:s("name")}),(0,v.jsx)(E.A,{className:"absolute bottom-2.5 left-2 dark:fill-gray-300"})]}),(0,v.jsxs)("div",{className:T,children:[(0,v.jsx)(C.A,{htmlFor:"desc",children:s("topic")}),(0,v.jsx)(B.A,{disabled:H,"data-type":"description",onChange:y,value:null!==P&&void 0!==P?P:"",rows:4,name:"name",id:"name",placeholder:s("topic_placeholder")})]}),!H&&i.is_admin&&(0,v.jsxs)("div",{className:T,children:[(0,v.jsx)(C.A,{htmlFor:"desc",children:s("visibility")}),(0,v.jsx)(k.A,{options:[s("public"),s("private")],values:["true","false"],value:String(o.is_public),onChange:s=>{b({is_public:"true"===s.toLowerCase(),id:e})}})]}),(0,v.jsx)(V.A,{empty:!0,version:"0.3.50",children:(0,v.jsxs)(v.Fragment,{children:[!H&&i.is_admin&&(0,v.jsx)(D,{id:e,only_owner_can_send_msg:$}),!H&&i.is_admin&&(0,v.jsx)(F,{id:e,show_email:O}),!H&&i.is_admin&&(0,v.jsx)(L,{id:e,dm_to_member:I}),!H&&i.is_admin&&(0,v.jsx)(G,{id:e,add_friend:Z})]})})]}),h&&(0,v.jsx)(N.A,{saveHandler:()=>{if(!p)return;const{name:s,description:n}=p;_({id:e,name:s,description:n})},resetHandler:()=>{f(u)}})]})}const O=e=>{const{t:s}=(0,a.Bd)("setting");return[{title:s("nav.general"),items:[{name:"overview",title:s("nav.overview"),component:(0,v.jsx)(P,{id:e})},{name:"auto_delete_msg",title:s("nav.auto_delete_msg"),component:(0,v.jsx)(y.A,{id:e})},{name:"members",title:s("nav.members"),component:(0,v.jsx)(A.A,{cid:e})}]}]};let I="";function Z(){const{t:e}=(0,a.Bd)("setting"),{cid:s=0,nav:n}=(0,i.g)(),c=(0,t.GV)((e=>e.authData.user),r.bN),d=(0,t.GV)((e=>s?e.channels.byId[+s]:void 0),r.bN),o=(0,i.Zp)(),[u]=(0,i.ok)(),m=O(+s),h=m.map((({items:e})=>e)).flat();I=I||(u.get("f")||"/");const[x,p]=(0,l.useState)(!1),[f,g]=(0,l.useState)(!1),A=()=>{p((e=>!e))},y=()=>{g((e=>!e))};if(!s)return null;const w=h.find((e=>e.name==n)),N=(null===c||void 0===c?void 0:c.is_admin)||(null===d||void 0===d?void 0:d.owner)==(null===c||void 0===c?void 0:c.uid),S=!(null!==d&&void 0!==d&&d.is_public);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j.A,{pathPrefix:`/setting/channel/${s}`,nav:w,closeModal:()=>{o(I),I=""},title:"Channel Settings",navs:m,dangers:[S&&{title:e("channel.leave"),handler:y},N&&{title:e("channel.delete"),handler:A}],children:n?null===w||void 0===w?void 0:w.component:null}),x&&(0,v.jsx)(b.A,{closeModal:A,id:+s}),f&&(0,v.jsx)(_,{closeModal:y,id:+s})]})}},10330:(e,s,n)=>{n.d(s,{A:()=>m});var l=n(64131),a=n(25293),i=n(79574),t=n(26634),c=n(64241),d=n(1393),r=n(77338),o=n(45891),u=n(82979);const m=({id:e,closeModal:s})=>{const{t:n}=(0,i.Bd)("setting"),{t:m}=(0,i.Bd)(),h=(0,t.Zp)(),[v,{isLoading:x,isSuccess:p}]=(0,c.eN)();return(0,l.useEffect)((()=>{p&&(a.Ay.success(m("tip.delete")),s(),h("/chat"))}),[p]),e?(0,u.jsx)(d.A,{id:"modal-modal",children:(0,u.jsx)(o.A,{compact:!0,title:n("channel.delete"),description:n("channel.delete_desc"),buttons:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.A,{onClick:s.bind(null,void 0),className:"cancel",children:m("action.cancel")}),(0,u.jsx)(r.A,{onClick:()=>{v(e)},className:"danger",children:x?"Deleting":m("action.remove")})]})})}):null}},23108:(e,s,n)=>{n.d(s,{A:()=>v});var l=n(64131),a=n(25293),i=n(79574),t=n(42687),c=n(64241),d=n(68812),r=n(6696),o=n(77338),u=n(74385),m=n(51612),h=n(82979);const v=({id:e,type:s="channel"})=>{var n,v;const x=(0,d.GV)((n=>"channel"==s?n.footprint.autoDeleteMsgChannels.find((s=>s.gid==e)):n.footprint.autoDeleteMsgUsers.find((s=>s.uid==e))),m.bN),p=(0,d.GV)((e=>e.authData.user),m.bN),f=(0,d.GV)((n=>"channel"==s?n.channels.byId[e]:null),m.bN),[g,{isSuccess:_}]=(0,t.B_)(),[j,{isSuccess:b}]=(0,c.Br)(),[A,y]=(0,l.useState)(null!==(n=null===x||void 0===x?void 0:x.expires_in)&&void 0!==n?n:0),{t:w}=(0,i.Bd)("setting",{keyPrefix:"auto_delete_msg"}),{t:N}=(0,i.Bd)(),S=[{title:w("off"),value:0},{title:w("5_min"),value:300},{title:w("10_min"),value:600},{title:w("1_hour"),value:3600},{title:w("1_day"),value:86400},{title:w("1_week"),value:604800}];(0,l.useEffect)((()=>{_&&a.oR.success(N("tip.update"))}),[_]),(0,l.useEffect)((()=>{b&&a.oR.success("Cleared!")}),[b]);const C=null!==(v=null===x||void 0===x?void 0:x.expires_in)&&void 0!==v?v:0,k="channel"==s&&((null===f||void 0===f?void 0:f.owner)==(null===p||void 0===p?void 0:p.uid)||(null===p||void 0===p?void 0:p.is_admin));return(0,h.jsxs)("section",{className:"max-w-[512px] h-full relative",children:[(0,h.jsxs)("div",{className:"text-sm",children:[(0,h.jsx)("h2",{className:"dark:text-white",children:w("title")}),(0,h.jsx)("p",{className:"text-gray-400 text-xs",children:w("desc")})]}),(0,h.jsx)("div",{className:"mt-4",children:(0,h.jsx)(u.A,{options:S.map((({title:e})=>e)),values:S.map((({value:e})=>e)),value:A||0,onChange:e=>{y(e)}})}),C!==A&&(0,h.jsx)(r.A,{saveHandler:()=>{g("dm"==s?{users:[{uid:e,expires_in:A}]}:{groups:[{gid:e,expires_in:A}]})},resetHandler:()=>{var e;y(null!==(e=null===x||void 0===x?void 0:x.expires_in)&&void 0!==e?e:0)}}),k&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"text-sm mt-8",children:[(0,h.jsx)("h2",{className:"dark:text-white",children:w("clear_title")}),(0,h.jsx)("p",{className:"text-gray-400 text-xs",children:w("clear_desc")})]}),(0,h.jsx)("div",{className:"mt-4",children:(0,h.jsx)(o.A,{className:"danger",onClick:()=>{confirm("are you sure?")&&j(e)},children:w("clear")})})]})]})}}}]);