"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[998],{12695:(e,n,t)=>{t.d(n,{A:()=>r});var i,a=t(91118);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:n,...t},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,i||(i=a.createElement("path",{d:"M21.7806 2.21967C22.0735 2.51256 22.0735 2.98744 21.7806 3.28033L18.5609 6.5L21.7806 9.71967C22.0735 10.0126 22.0735 10.4874 21.7806 10.7803C21.4877 11.0732 21.0128 11.0732 20.7199 10.7803L17.5002 7.56066L14.2806 10.7803C13.9877 11.0732 13.5128 11.0732 13.2199 10.7803C12.927 10.4874 12.927 10.0126 13.2199 9.71967L16.4396 6.5L13.2199 3.28033C12.927 2.98744 12.927 2.51256 13.2199 2.21967C13.5128 1.92678 13.9877 1.92678 14.2806 2.21967L17.5002 5.43934L20.7199 2.21967C21.0128 1.92678 21.4877 1.92678 21.7806 2.21967ZM9.36737 3.31232L10.2271 5.33967C10.6018 6.22312 10.3939 7.26203 9.71313 7.90815L7.81881 9.70616C7.93569 10.7816 8.2972 11.8406 8.90334 12.8832C9.50948 13.9257 10.2665 14.7905 11.1744 15.4776L13.4496 14.7189C14.312 14.4313 15.2512 14.7618 15.7802 15.539L17.0125 17.3495C17.6275 18.2529 17.5169 19.4993 16.7538 20.2653L15.9361 21.0862C15.1222 21.9033 13.9597 22.1997 12.8843 21.8643C10.3454 21.0723 8.01109 18.7211 5.88132 14.8107C3.74845 10.8945 2.9957 7.57189 3.62307 4.84289C3.88707 3.69457 4.70458 2.78009 5.77209 2.43899L6.84868 2.09498C7.8575 1.77263 8.93535 2.29358 9.36737 3.31232Z"}))),r=(0,a.forwardRef)(o)},17429:(e,n,t)=>{t.d(n,{A:()=>h});var i=t(31210),a=t(747),l=t.n(a);const o=t.p+"static/media/join.32e45d691d059a55188a.wav";var r=t(69259),d=t(77774),s=t(19535),c=t(28512),u=t(86560);const v=new Audio(o),h=({id:e,context:n="channel"})=>{const t=(0,i.wA)(),a=(0,c.GV)((e=>{var n,t;return null!==(n=null===(t=e.authData.user)||void 0===t?void 0:t.uid)&&void 0!==n?n:0}),i.bN),o=(0,c.GV)((e=>e.voice.voicing),i.bN),h=(0,c.GV)((t=>"channel"==n?"voice_fullscreen"==t.footprint.channelAsides[e]:"voice_fullscreen"==t.footprint.dmAsides[e]),i.bN),m=(0,c.GV)((e=>{var n;return null!==(n=e.voice.devices.filter((e=>"audioinput"==e.kind)))&&void 0!==n?n:[]}),i.bN),w=(0,c.GV)((e=>{var n;return null!==(n=e.voice.devices.filter((e=>"audiooutput"==e.kind)))&&void 0!==n?n:[]}),i.bN),p=(0,c.GV)((e=>{var n;return null!==(n=e.voice.devices.filter((e=>"videoinput"==e.kind)))&&void 0!==n?n:[]}),i.bN),f=(0,c.GV)((e=>e.voice.audioInputDeviceId),i.bN),g=(0,c.GV)((e=>e.voice.audioOutputDeviceId),i.bN),C=(0,c.GV)((e=>e.voice.videoInputDeviceId),i.bN),[b]=(0,r.lY)(),x=async()=>{const i=window.VIDEO_TRACK_MAP[a];if(i){var l;await(null===(l=window.VOICE_CLIENT)||void 0===l?void 0:l.unpublish(i)),i.close(),window.VIDEO_TRACK_MAP[a]=null;document.querySelector(`#CAMERA_${a}`).classList.remove("h-[120px]"),t((0,s.rR)({video:!1,shareScreen:!1,id:e,context:n}))}},A=async()=>{var i;let l=window.VIDEO_TRACK_MAP[a];if(!l)return;await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.unpublish(l)),"close"in l?l.close():l[0].close(),window.VIDEO_TRACK_MAP[a]=null;document.querySelector(`#CAMERA_${a}`).classList.remove("h-[120px]"),t((0,s.rR)({video:!1,shareScreen:!1,id:e,context:n}))},_=!!o&&(o.id==e&&o.context==n);return{setMute:i=>{const l=window.VOICE_TRACK_MAP[a];l&&(l.setMuted(i),0==i&&null!==o&&void 0!==o&&o.deafen&&(Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)})),t((0,s.rR)({muted:!1,id:e,context:n}))),t((0,s.rR)({muted:i,id:e,context:n})))},setDeafen:i=>{const l=window.VOICE_TRACK_MAP[a];l&&(i?(l.setMuted(!0),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(0)}))):(l.setMuted(!1),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)}))),t((0,s.rR)({deafen:i,id:e,context:n})))},leave:async()=>{const i=window.VOICE_TRACK_MAP[a],l=window.VIDEO_TRACK_MAP[a];if(window.VOICE_CLIENT){await window.VOICE_CLIENT.leave(),i&&(i.close(),window.VOICE_TRACK_MAP[a]=null),l&&(l.close(),window.VIDEO_TRACK_MAP[a]=null),window.VOICE_TRACK_MAP={},window.VIDEO_TRACK_MAP={},t((0,s.rR)(null));const o="channel"==n?d.jn:d.fd;t(o({id:e,aside:"dm"==n?"voice":null})),t((0,s.m0)({id:e,context:n,memberCount:"dm"==n?1:0,channelName:`vocechat:${n}:${e}`}))}},voicingInfo:o,joining:o?o.joining:void 0,joinedAtThisContext:_,joined:!!o,joinVoice:async()=>{t((0,s.rR)({id:e,context:n,joining:!0}));const i=await b("channel"==n?{gid:e}:{uid:e});if("error"in i)console.error("generate agora token error"),t((0,s.rR)({joining:!1,id:e,context:n}));else{console.table(i.data);const{channel_name:r,app_id:d,agora_token:c,uid:u}=i.data;if(window.VOICE_CLIENT){await window.VOICE_CLIENT.join(d,r,c,u);const i=await l().createMicrophoneAudioTrack({microphoneId:f});await window.VOICE_CLIENT.publish(i);try{await v.play()}catch(o){console.warn("play join sound failed!",o)}t((0,s.rR)({deafen:!1,muted:!1,joining:!1,id:e,context:n})),t((0,s.Oy)(u)),window.VOICE_TRACK_MAP[a]=i}}},openCamera:async()=>{var i;const o=await l().createCameraVideoTrack({cameraId:C});await A(),await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.publish(o)),t((0,s.rR)({video:!0,shareScreen:!1,id:e,context:n})),window.VIDEO_TRACK_MAP[a]=o,(0,u.Qv)(a)},closeCamera:x,startShareScreen:async()=>{try{var i;const o=await l().createScreenVideoTrack({selfBrowserSurface:"exclude",encoderConfig:"1080p_1",optimizationMode:"detail"});await x(),await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.publish(o)),t((0,s.rR)({video:!1,shareScreen:!0,id:e,context:n})),window.VIDEO_TRACK_MAP[a]=o,(0,u.Qv)(a),t("channel"==n?(0,d.jn)({id:e,aside:"voice_fullscreen"}):(0,d.fd)({id:e,aside:"voice_fullscreen"})),t((0,s.Hm)({uid:a,action:"pin"})),"close"in o&&(o.getMediaStreamTrack().onended=()=>{A()})}catch(o){}},stopShareScreen:A,enterFullscreen:i=>{t("channel"==n?(0,d.jn)({id:e,aside:"voice_fullscreen"}):(0,d.fd)({id:e,aside:"voice_fullscreen"})),i&&t((0,s.Hm)({uid:i,action:"pin"}))},exitFullscreen:()=>{t("channel"==n?(0,d.jn)({id:e,aside:"voice"}):(0,d.fd)({id:e,aside:null}))},fullscreen:h,audioInputDevices:m,audioOutputDevices:w,videoInputDevices:p,audioInputDeviceId:f,audioOutputDeviceId:g,videoInputDeviceId:C}}},29619:(e,n,t)=>{t.d(n,{A:()=>d});var i=t(6858),a=t(66514),l=t(86560),o=t(45646);const r=({placement:e})=>{if("left"==e)return null;const n=(0,a.A)("w-3 h-3 bg-inherit absolute rounded-[1px] origin-center rotate-45","right"==e&&"left-0 top-1/2 -translate-x-1/2 -translate-y-1/2","top"==e&&"left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2","bottom"==e&&"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2");return(0,o.jsx)("i",{className:n})},d=({tip:e="",placement:n="right",delay:t=null,children:a,...d})=>(0,o.jsx)(i.Ay,{disabled:(0,l.Fr)(),offset:[0,18],duration:t?[300,250]:0,delay:null!==t&&void 0!==t?t:[150,0],placement:n,content:(0,o.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 px-3 py-2 text-xs rounded-lg drop-shadow text-gray-700 dark:text-gray-100",children:[(0,o.jsx)(r,{placement:n}),e]}),...d,children:a})},39837:(e,n,t)=>{t.d(n,{A:()=>p});var i=t(91118),a=t(90184),l=t(23558),o=t(31210),r=t(86938),d=t(20446),s=t(11701),c=t(107),u=t(77774),v=t(19535),h=t(28512),m=t(79096),w=t(24168);const p=({uid:e,cid:n})=>{const{joinVoice:t,joined:p,joining:f=!1,joinedAtThisContext:g}=(0,m.c)({id:null!==e&&void 0!==e?e:0,context:"dm"}),C=(0,o.wA)(),{t:b}=(0,l.Bd)(),[x,A]=(0,i.useState)(void 0),_=(0,r.RQ)(`/users/${e}`),[y]=(0,c.QI)(),[E,{isSuccess:j}]=(0,c.H7)(),[N,{isSuccess:I}]=(0,c.Gv)(),[V,{isSuccess:O}]=(0,s.Yl)(),k=(0,r.Zp)(),{copy:R}=(0,w.A)(),M=(0,h.GV)((n=>"undefined"!==typeof e?n.users.byId[e]:void 0),o.bN),T=(0,h.GV)((e=>"undefined"!==typeof n?e.channels.byId[n]:void 0),o.bN),L=(0,h.GV)((e=>e.authData.user),o.bN),D=(0,h.GV)((e=>e.server.upgraded),o.bN),{show_email:P=!0,dm_to_member:$=!0}=null!==T&&void 0!==T?T:{};(0,i.useEffect)((()=>{A(null!==e&&void 0!==e?e:null===L||void 0===L?void 0:L.uid)}),[e,L]),(0,i.useEffect)((()=>{j&&a.Ay.success(b("tip.update"))}),[j]),(0,i.useEffect)((()=>{(O||I)&&(a.Ay.success(b("tip.delete")),I&&_&&k("/users"))}),[O,I,_]);const K=!(null===L||void 0===L||!L.is_admin),G=null===L||void 0===L?void 0:L.uid,S=!!n&&!(null!==T&&void 0!==T&&T.is_public)&&K,F=!!n&&!(null!==T&&void 0!==T&&T.is_public)&&(K||(null===T||void 0===T?void 0:T.owner)==G)&&e!=(null===T||void 0===T?void 0:T.owner),B=K&&G!=e&&!n&&1!==e,Z=G!=e,U=G!=e,Q=!!n&&((null===L||void 0===L?void 0:L.is_admin)||(null===T||void 0===T?void 0:T.owner)==(null===L||void 0===L?void 0:L.uid)),z=!(null===L||void 0===L||!L.is_admin)&&D,H=!(null===L||void 0===L||!L.is_admin)&&G!=e&&1!==e;return{showEmailInChannel:P,isChannelOwner:(null===L||void 0===L?void 0:L.uid)==(null===T||void 0===T?void 0:T.owner)||(null===T||void 0===T?void 0:T.is_public)&&K,isAdmin:!(null===M||void 0===M||!M.is_admin),updateRole:()=>{e&&E({id:e,is_admin:!(null!==M&&void 0!==M&&M.is_admin)})},updatePassword:n=>{e&&E({id:e,password:n})},canUpdateRole:K&&G!=e&&1!=e,removeFromContact:()=>{e&&y({target_uid:e,action:"remove"})},canBlock:Z,canRemoveFromContact:U,blocked:"blocked"==(null===M||void 0===M?void 0:M.status),blockThisContact:()=>{void 0!==e&&y({target_uid:e,action:"block"})},unblockThisContact:()=>{void 0!==e&&y({target_uid:e,action:"unblock"})},canInviteChannel:Q,canDeleteChannel:S,canRemove:B,removeUser:e=>{const n=!Number.isNaN(+e)&&e||x;n&&(N(n),(0,d.cJ)())},startChat:()=>{k(`/chat/dm/${e}`)},removeFromChannel:e=>{if(!n)return;const t=!Number.isNaN(+e)&&e||x;t&&(V({id:+n,members:[+t]}),(0,d.cJ)())},canRemoveFromChannel:F,canCopyEmail:!(null===M||void 0===M||!M.email)&&P,copyEmail:e=>{const n="string"==typeof e&&e||(null===M||void 0===M?void 0:M.email);R(n||""),(0,d.cJ)()},canDM:$,startCall:()=>{if(f||p)return void alert("You have joined another channel, please leave first!");t();const n={id:null!==e&&void 0!==e?e:0,aside:"voice"};var i;(C((0,u.fd)(n)),g)||C((0,v.uU)({from:null!==(i=null===L||void 0===L?void 0:L.uid)&&void 0!==i?i:0,to:e,calling:!1}));k(`/chat/dm/${e}`)},canViewPassword:z,canUpdatePassword:H}}},40495:(e,n,t)=>{t.d(n,{A:()=>r});var i=t(91118),a=t(86560),l=t(45646);function o(e){return e<=16?8:e<=24?12:e<=32?16:e<=40?18:e<=56?22:e<=80?48:64}const r=({src:e="",name:n="Deleted User",type:t="user",width:r,height:d,...s})=>{const[c,u]=(0,i.useState)(!1),v=()=>{u(!0)};if(!c&&e)return(0,l.jsx)("img",{width:r,height:d,src:e,onError:v,...s});let h=(0,a.IM)(n).substring(0,6);const m=h.length,w=m>2?(11-m)/10:1;return(0,l.jsx)("div",{className:`rounded-full flex-center ${s.className||""}`,style:{width:r,height:d,fontSize:o(r),fontWeight:400,fontFamily:"'Lato', 'Lato-Regular', 'Helvetica Neue'",background:"channel"===t?"#EAECF0":"#4c99e9",color:"channel"===t?"#475467":"#FFFFFF"},children:(0,l.jsx)("span",{className:"whitespace-nowrap",style:{transform:`scale(${w})`},children:h})})}},45353:(e,n,t)=>{t.d(n,{A:()=>r});var i,a=t(91118);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:n,...t},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"#616161",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,i||(i=a.createElement("path",{d:"M8 12C8 13.1046 7.10457 14 6 14C4.89543 14 4 13.1046 4 12C4 10.8954 4.89543 10 6 10C7.10457 10 8 10.8954 8 12ZM14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12ZM18 14C19.1046 14 20 13.1046 20 12C20 10.8954 19.1046 10 18 10C16.8954 10 16 10.8954 16 12C16 13.1046 16.8954 14 18 14Z"}))),r=(0,a.forwardRef)(o)},63133:(e,n,t)=>{t.d(n,{A:()=>h});var i,a,l=t(6858),o=t(91118);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(null,arguments)}const d=({title:e,titleId:n,...t},l)=>o.createElement("svg",r({width:16,height:16,viewBox:"0 0 16 16",fill:"#475467",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":n},t),e?o.createElement("title",{id:n},e):null,o.createElement("mask",{id:"mask0_18505_74130",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:16,height:16},i||(i=o.createElement("rect",{width:16,height:16,fill:"#D9D9D9"}))),a||(a=o.createElement("g",{mask:"url(#mask0_18505_74130)"},o.createElement("path",{d:"M4.76666 14.0667C4.6 13.9 4.51666 13.7028 4.51666 13.475C4.51666 13.2472 4.6 13.05 4.76666 12.8834L9.65 8.00002L4.75 3.10002C4.59444 2.94446 4.51666 2.75002 4.51666 2.51669C4.51666 2.28335 4.6 2.08335 4.76666 1.91669C4.93333 1.75002 5.13055 1.66669 5.35833 1.66669C5.58611 1.66669 5.78333 1.75002 5.95 1.91669L11.55 7.53335C11.6167 7.60002 11.6639 7.67224 11.6917 7.75002C11.7194 7.8278 11.7333 7.91113 11.7333 8.00002C11.7333 8.08891 11.7194 8.17224 11.6917 8.25002C11.6639 8.3278 11.6167 8.40002 11.55 8.46669L5.93333 14.0834C5.77777 14.2389 5.58611 14.3167 5.35833 14.3167C5.13055 14.3167 4.93333 14.2334 4.76666 14.0667Z"})))),s=(0,o.forwardRef)(d);var c=t(83679),u=t(45646);const v=({items:e,hideMenu:n,child:t})=>(0,u.jsx)(l.Ay,{interactive:!0,placement:"auto-start",trigger:"mouseenter focus",content:(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:t,icon:i=null,handler:a=e=>{e.preventDefault(),n&&n()},underline:l=!1,danger:o=!1,checked:r=!1}=e;return(0,u.jsxs)("li",{className:`item group ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),r||(a(e),n&&n())},children:[i,t,r&&(0,u.jsx)(c.A,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},t)}))}),children:t}),h=({items:e=[],hideMenu:n=null})=>(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:t,icon:i=null,handler:a=e=>{e.preventDefault(),n&&n()},underline:l=!1,danger:o=!1,subs:r=[]}=e;return r.length>0?(0,u.jsx)(v,{items:r,hideMenu:n,child:(0,u.jsxs)("li",{className:`item group ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[i,t,(0,u.jsx)(s,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},t)},t):(0,u.jsxs)("li",{className:`item ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),a(e),n&&n()},children:[i,t]},t)}))})},70837:(e,n,t)=>{t.d(n,{A:()=>A});var i,a=t(91118),l=t(23558),o=t(86938),r=t(6858),d=t(66514),s=t(69259),c=t(28512),u=t(39837),v=t(76386);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},h.apply(null,arguments)}const m=({title:e,titleId:n,...t},l)=>a.createElement("svg",h({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,i||(i=a.createElement("path",{d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.3596 22 8.77516 21.6039 7.35578 20.8583L3.06538 21.9753C2.6111 22.0937 2.1469 21.8213 2.02858 21.367C1.99199 21.2266 1.99198 21.0791 2.02855 20.9386L3.1449 16.6502C2.3972 15.2294 2 13.6428 2 12C2 6.47715 6.47715 2 12 2Z",fill:"#22CCEE"}))),w=(0,a.forwardRef)(m);var p=t(45353),f=t(40495),g=t(63133),C=t(31210),b=t(45646);const x=({uid:e,type:n="embed",cid:t})=>{const{data:i}=(0,s.A4)(),{t:a}=(0,l.Bd)("member"),{t:h}=(0,l.Bd)(),{canDM:m,canCopyEmail:x,copyEmail:A,startCall:_,removeFromChannel:y,canRemoveFromChannel:E,canRemove:j,removeUser:N,isAdmin:I,canUpdateRole:V,updateRole:O}=(0,u.A)({uid:e,cid:t}),k=(0,c.GV)((n=>n.users.byId[e]),C.bN);if(!k)return null;const{name:R,email:M,avatar:T}=k,L="card"==n,D=!L&&j,P=M||E||D,$="cursor-pointer flex flex-col items-center gap-1 rounded-lg w-32 text-primary-400 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 text-sm pt-3.5 pb-3",K=(0,d.A)("flex-center flex-col gap-1 z-[99] mt-20 select-none",L?"p-4 w-[280px] bg-white dark:bg-gray-800 drop-shadow rounded-md":"md:w-[432px]");return(0,b.jsxs)("div",{className:K,children:[(0,b.jsx)(f.A,{width:80,height:80,className:"rounded-full w-20 h-20 object-cover",src:T,name:R}),(0,b.jsxs)("h2",{className:"text-lg select-text font-bold text-gray-900 dark:text-white",children:[R," ",m&&(0,b.jsxs)("span",{className:"font-normal text-gray-500",children:["#",e]})]}),x&&(0,b.jsx)("span",{className:"text-sm text-gray-400 dark:text-gray-200 select-text",children:M}),m&&(0,b.jsxs)("ul",{className:(0,d.A)("mt-6 flex flex-col md:flex-row items-center gap-2",L&&"pb-0.5"),children:[(0,b.jsx)(o.k2,{to:`/chat/dm/${e}`,children:(0,b.jsxs)("li",{className:`${$} icon chat`,children:[(0,b.jsx)(w,{}),(0,b.jsx)("span",{children:a("send_msg")})]})}),i&&"embed"==n&&(0,b.jsxs)("li",{role:"button",onClick:_,className:`${$} icon chat`,children:[(0,b.jsx)(v.A,{className:"fill-primary-400"}),(0,b.jsx)("span",{children:a("call")})]}),(0,b.jsx)(r.Ay,{disabled:!P,interactive:!0,popperOptions:{strategy:"fixed"},placement:"right",trigger:"click",hideOnClick:!0,content:(0,b.jsx)(g.A,{items:[i&&"card"==n&&{title:a("call"),handler:_},x&&{title:a("copy_email"),handler:A},V&&{title:a("roles"),handler:O,subs:[{title:a("set_normal"),checked:!I,handler:O},{title:a("set_admin"),checked:I,handler:O}]},E&&{title:a("remove_from_channel"),danger:!0,handler:y},D&&{title:a("remove"),handler:N,danger:!0}].filter(Boolean)}),children:(0,b.jsxs)("li",{className:`${$} icon ${P?"":"text-gray-500"}`,children:[(0,b.jsx)(p.A,{className:P?"fill-primary-500":""}),(0,b.jsx)("span",{children:h("more")})]})})]})]})},A=(0,a.memo)(x)},76386:(e,n,t)=>{t.d(n,{A:()=>r});var i,a=t(91118);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:n,...t},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,i||(i=a.createElement("path",{d:"M7.7716 2.43923L8.84819 2.09522C9.85701 1.77287 10.9349 2.29382 11.3669 3.31256L12.2266 5.33991C12.6013 6.22336 12.3934 7.26227 11.7126 7.9084L9.81832 9.70641C9.9352 10.7819 10.2967 11.8409 10.9029 12.8834C11.509 13.9259 12.266 14.7907 13.1739 15.4778L15.4491 14.7191C16.3115 14.4315 17.2507 14.762 17.7797 15.5392L19.0121 17.3498C19.627 18.2532 19.5164 19.4995 18.7534 20.2655L17.9356 21.0865C17.1217 21.9036 15.9592 22.2 14.8838 21.8645C12.3449 21.0726 10.0106 18.7214 7.88083 14.8109C5.74796 10.8947 4.99521 7.57214 5.62258 4.84313C5.88658 3.69482 6.70409 2.78033 7.7716 2.43923Z"}))),r=(0,a.forwardRef)(o)},79096:(e,n,t)=>{t.d(n,{A:()=>j,c:()=>C.A});var i=t(91118),a=t(31210),l=t(747),o=t.n(l),r=t(69259),d=t(19535),s=t(28512),c=t(86560),u=t(86938),v=t(44299),h=t(66514),m=t(13986),w=t(12695),p=t(76386),f=t(40495),g=t(29619),C=t(17429),b=t(45646);const x=({from:e,to:n=0})=>{const t=(0,u.Zp)(),{pathname:l}=(0,u.zy)(),o=(0,a.wA)(),{leave:r,joinVoice:x,joining:A}=(0,C.A)({id:n,context:"dm"}),_=(0,i.useRef)(null),y=(0,s.GV)((e=>{var n;return null===(n=e.authData.user)||void 0===n?void 0:n.uid}),a.bN),E=(0,s.GV)((e=>e.voice.calling),a.bN),j=(0,s.GV)((e=>e.voice.voicingMembers),a.bN),N=(0,s.GV)((n=>n.users.byId[e]),a.bN),I=(0,s.GV)((e=>e.users.byId[n]),a.bN),V=y!==I.uid;(0,i.useEffect)((()=>{j.ids.forEach((e=>{(0,c.Qv)(e)}))}),[j.ids]);const{name:O,avatar:k}=V?I:N,R=2==j.ids.length;return N&&I&&!R&&!(V?l==`/chat/dm/${n}`:l==`/chat/dm/${e}`)&&E?(0,b.jsx)("div",{ref:_,className:"fixed top-0 left-0 w-full h-screen z-[999] pointer-events-none flex items-center justify-end pr-10",children:(0,b.jsxs)(m.P.aside,{drag:!0,dragConstraints:_,dragMomentum:!1,whileDrag:{scale:1.1},className:(0,h.A)("pointer-events-auto \n        rounded bg-gray-800  relative\n        shadow-lg shadow-slate-200 dark:shadow-slate-800 \n        cursor-move overflow-hidden\n        w-64 h-80\n        "),children:[(0,b.jsx)("div",{className:"absolute right-0-0 top-0 w-40 h-32",id:`CAMERA_${n}`}),(0,b.jsxs)("div",{className:(0,h.A)("absolute left-0 top-0 py-5 w-full h-full flex flex-col justify-between items-center",R?"bg-transparent":"bg-gray-800"),children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,b.jsx)("div",{className:"rounded-full overflow-hidden w-20 h-20 shrink-0",children:(0,b.jsx)(f.A,{name:O,src:k,width:80,height:80,className:"h-20"})}),(0,b.jsx)("span",{className:"text-white mb-2",children:O})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 items-center my-4",children:[(0,b.jsx)(v.A,{size:18,lineWeight:3,speed:1,color:"#aaa"}),(0,b.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:V?"Calling":"Incoming call"})]}),(0,b.jsxs)("div",{className:(0,h.A)("flex gap-3",R?"h-full items-end":""),children:[(0,b.jsx)(g.A,{tip:"Disconnect",placement:"top",children:(0,b.jsx)("button",{onClick:()=>{(V||2==j.ids.length)&&r(),o((0,d.eu)(!1))},className:"flex-center bg-red-600 hover:bg-red-700 py-2 px-3 rounded-lg",children:(0,b.jsx)(w.A,{className:"w-6 h-6"})})}),!V&&(0,b.jsx)(g.A,{tip:"Answer",placement:"top",children:(0,b.jsx)("button",{disabled:A,onClick:()=>{x(),t(`/chat/dm/${e}`)},className:"flex-center bg-green-600 hover:bg-green-700 py-2 px-3 rounded-lg",children:(0,b.jsx)(p.A,{className:"w-6 h-6 fill-white"})})})]})]})]})}):null};var A,_;o().setLogLevel(4),window.VOICE_TRACK_MAP=null!==(A=window.VOICE_TRACK_MAP)&&void 0!==A?A:{},window.VIDEO_TRACK_MAP=null!==(_=window.VIDEO_TRACK_MAP)&&void 0!==_?_:{};const y=(0,c.GZ)(),E=()=>{const e=(0,s.GV)((e=>{var n;return null===(n=e.authData.user)||void 0===n?void 0:n.uid}),a.bN),n=(0,s.GV)((e=>e.voice.callingFrom),a.bN),t=(0,s.GV)((e=>e.voice.callingTo),a.bN),l=(0,s.GV)((e=>e.voice.list),a.bN),u=(0,s.GV)((e=>e.voice.voicing),a.bN),{data:v}=(0,r.A4)(),[h]=(0,r.CH)();(0,r.mK)({page_no:0,page_size:100},{skip:!v||!navigator.onLine,pollingInterval:1e4});const m=(0,a.wA)();return(0,i.useEffect)((()=>{const e=e=>{var n;if("CONNECTED"===(null===(n=window.VOICE_CLIENT)||void 0===n?void 0:n.connectionState))return e.preventDefault(),e.returnValue=""};return window.VOICE_CLIENT||y||((async()=>{const e=o().createClient({mode:"rtc",codec:"vp8"});e.enableAudioVolumeIndicator(),e.on("user-published",(async(n,t)=>{var i;await e.subscribe(n,t),"audio"==t&&n.hasAudio&&(null===(i=n.audioTrack)||void 0===i||i.play(),window.VOICE_TRACK_MAP[+n.uid]=n.audioTrack),"video"==t&&n.hasVideo&&(m((0,d.$y)({uid:+n.uid,info:{video:!0}})),window.VIDEO_TRACK_MAP[+n.uid]=n.videoTrack,(0,c.Qv)(+n.uid)),e.on("user-unpublished",(e=>{e.hasAudio||m((0,d.$y)({uid:+e.uid,info:{muted:!0}})),e.hasVideo||(m((0,d.$y)({uid:+e.uid,info:{video:!1,shareScreen:!1}})),window.VIDEO_TRACK_MAP[+e.uid]=null,document.querySelector(`#CAMERA_${e.uid}`).classList.remove("h-[120px]"))})),e.on("user-left",((e,n)=>{switch(n){case"Quit":case"ServerTimeOut":m((0,d.Rl)(+e.uid)),window.VOICE_TRACK_MAP[+e.uid]=null,window.VIDEO_TRACK_MAP[+e.uid]=null}})),e.on("volume-indicator",(e=>{e.forEach(((e,n)=>{e.uid,e.level;const{uid:t,level:i}=e;m((0,d.$y)({uid:+t,info:{speakingVolume:i}}))}))})),e.on("network-quality",(e=>{const{downlinkNetworkQuality:n}=e;m((0,d.OP)(n))})),e.on("connection-state-change",((e,n,t)=>{m((0,d.bp)(e))})),e.on("user-info-updated",((e,n)=>{switch(n){case"mute-audio":m((0,d.$y)({uid:+e,info:{muted:!0}}));break;case"unmute-audio":m((0,d.$y)({uid:+e,info:{muted:!1}}));break;case"mute-video":m((0,d.$y)({uid:+e,info:{video:!1}}));break;case"unmute-video":m((0,d.$y)({uid:+e,info:{video:!0}}))}}))})),e.on("user-joined",(async e=>{e.uid,m((0,d.Oy)(+e.uid))})),o().onMicrophoneChanged=e=>{},window.VOICE_CLIENT=e})(),window.addEventListener("beforeunload",e,{capture:!0})),()=>{window.removeEventListener("beforeunload",e,{capture:!0})}}),[u]),(0,i.useEffect)((()=>{if(y)return;const n=l.filter((n=>"dm"==n.context&&n.id==e));if(n.length){const[t]=n,{memberCount:i,channelName:a,id:l}=t;1==i&&h(a).then((n=>{var t;const[i]=null!==(t=n.data)&&void 0!==t?t:[];i&&i!=e&&m((0,d.uU)({from:i,to:l}))}))}}),[l,e,y]),0!==n?(0,b.jsx)(x,{from:n,to:t}):null},j=(0,i.memo)(E)},83679:(e,n,t)=>{t.d(n,{A:()=>d});var i,a,l=t(91118);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o.apply(null,arguments)}const r=({title:e,titleId:n,...t},r)=>l.createElement("svg",o({width:16,height:12,viewBox:"0 0 16 12",fill:"#78787C",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":n},t),e?l.createElement("title",{id:n},e):null,i||(i=l.createElement("g",{clipPath:"url(#clip0_9046_23916)"},l.createElement("path",{d:"M4.93942 9.69781L1.62578 6.38648C1.25336 6.01431 0.651746 6.01431 0.27932 6.38648C-0.0931066 6.75865 -0.0931066 7.35984 0.27932 7.73201L4.27096 11.7209C4.64339 12.093 5.245 12.093 5.61743 11.7209L15.7207 1.62465C16.0931 1.25248 16.0931 0.651292 15.7207 0.279125C15.3483 -0.0930417 14.7466 -0.0930417 14.3742 0.279125L4.93942 9.69781Z"}))),a||(a=l.createElement("defs",null,l.createElement("clipPath",{id:"clip0_9046_23916"},l.createElement("rect",{width:16,height:12,fill:"white"}))))),d=(0,l.forwardRef)(r)}}]);