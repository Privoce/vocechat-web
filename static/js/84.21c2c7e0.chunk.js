"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[84],{6712:(e,t,s)=>{s.d(t,{A:()=>l});var a,r=s(64131);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n.apply(null,arguments)}const i=({title:e,titleId:t,...s},i)=>r.createElement("svg",n({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:i,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,a||(a=r.createElement("path",{d:"M8.79053 19.3376C10.0779 20.3775 11.7161 21.0002 13.4999 21.0002C14.6315 21.0002 15.7064 20.7491 16.6701 20.299L20.1027 20.9856C20.3486 21.0348 20.6029 20.9579 20.7802 20.7806C20.9575 20.6032 21.0345 20.349 20.9853 20.1031L20.2988 16.6702C20.7488 15.7065 20.9999 14.6318 20.9999 13.5002C20.9999 11.7168 20.3774 10.0788 19.338 8.79163C19.4443 9.3448 19.4999 9.91599 19.4999 10.5002C19.4999 11.0652 19.4479 11.618 19.3483 12.1541C19.4475 12.5868 19.4999 13.0374 19.4999 13.5002C19.4999 14.4837 19.2638 15.41 18.8458 16.2274C18.7689 16.3779 18.745 16.5501 18.7782 16.7159L19.2938 19.2941L16.7159 18.7784C16.55 18.7452 16.3778 18.7691 16.2273 18.8461C15.4098 19.2641 14.4835 19.5002 13.4999 19.5002C13.037 19.5002 12.5864 19.4478 12.1537 19.3486C11.6176 19.4481 11.0648 19.5002 10.4999 19.5002C9.91613 19.5002 9.34454 19.4443 8.79053 19.3376ZM10.5 3C6.35788 3 3.00001 6.35786 3.00001 10.5C3.00001 11.6316 3.2511 12.7064 3.70112 13.6701L3.01458 17.103C2.9654 17.3489 3.04237 17.6031 3.2197 17.7804C3.39702 17.9577 3.65123 18.0347 3.89713 17.9855L7.32974 17.2988C8.29349 17.7489 9.36836 18 10.5 18C14.6421 18 18 14.6421 18 10.5C18 6.35786 14.6421 3 10.5 3Z"}))),l=(0,r.forwardRef)(i)},24693:(e,t,s)=>{s.d(t,{A:()=>L});var a,r,n,i=s(64131),l=s(26634),c=s(30001),o=s(22404),d=s(68812),u=s(74903);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},m.apply(null,arguments)}const h=({title:e,titleId:t,...s},l)=>i.createElement("svg",m({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},s),e?i.createElement("title",{id:t},e):null,a||(a=i.createElement("circle",{cx:8,cy:8,r:8,fill:"#155EEF"})),i.createElement("mask",{id:"mask0_19353_2918",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:2,y:2,width:12,height:12},r||(r=i.createElement("rect",{x:2,y:2,width:12,height:12,fill:"#D9D9D9"}))),n||(n=i.createElement("g",{mask:"url(#mask0_19353_2918)"},i.createElement("path",{d:"M4.5 12.5C4.35833 12.5 4.23958 12.4521 4.14375 12.3562C4.04792 12.2604 4 12.1417 4 12V10C4 9.725 4.09792 9.48958 4.29375 9.29375C4.48958 9.09792 4.725 9 5 9H11C11.275 9 11.5104 9.09792 11.7062 9.29375C11.9021 9.48958 12 9.725 12 10V12C12 12.1417 11.9521 12.2604 11.8562 12.3562C11.7604 12.4521 11.6417 12.5 11.5 12.5H4.5ZM6.5 8.5C5.80833 8.5 5.21875 8.25625 4.73125 7.76875C4.24375 7.28125 4 6.69167 4 6C4 5.30833 4.24375 4.71875 4.73125 4.23125C5.21875 3.74375 5.80833 3.5 6.5 3.5H9.5C10.1917 3.5 10.7812 3.74375 11.2687 4.23125C11.7562 4.71875 12 5.30833 12 6C12 6.69167 11.7562 7.28125 11.2687 7.76875C10.7812 8.25625 10.1917 8.5 9.5 8.5H6.5ZM5 11.5H11V10H5V11.5ZM6.5 7.5H9.5C9.91667 7.5 10.2708 7.35417 10.5625 7.0625C10.8542 6.77083 11 6.41667 11 6C11 5.58333 10.8542 5.22917 10.5625 4.9375C10.2708 4.64583 9.91667 4.5 9.5 4.5H6.5C6.08333 4.5 5.72917 4.64583 5.4375 4.9375C5.14583 5.22917 5 5.58333 5 6C5 6.41667 5.14583 6.77083 5.4375 7.0625C5.72917 7.35417 6.08333 7.5 6.5 7.5ZM6.5 6.5C6.64167 6.5 6.76042 6.45208 6.85625 6.35625C6.95208 6.26042 7 6.14167 7 6C7 5.85833 6.95208 5.73958 6.85625 5.64375C6.76042 5.54792 6.64167 5.5 6.5 5.5C6.35833 5.5 6.23958 5.54792 6.14375 5.64375C6.04792 5.73958 6 5.85833 6 6C6 6.14167 6.04792 6.26042 6.14375 6.35625C6.23958 6.45208 6.35833 6.5 6.5 6.5ZM9.5 6.5C9.64167 6.5 9.76042 6.45208 9.85625 6.35625C9.95208 6.26042 10 6.14167 10 6C10 5.85833 9.95208 5.73958 9.85625 5.64375C9.76042 5.54792 9.64167 5.5 9.5 5.5C9.35833 5.5 9.23958 5.54792 9.14375 5.64375C9.04792 5.73958 9 5.85833 9 6C9 6.14167 9.04792 6.26042 9.14375 6.35625C9.23958 6.45208 9.35833 6.5 9.5 6.5Z",fill:"white"})))),v=(0,i.forwardRef)(h);var g=s(33139),p=s(63155),f=s(14651),x=s(79574),C=s(77377),b=s(85644),w=s(47049),y=s(82979);const j=({enable:e=!1,uid:t,cid:s,visible:a,hide:r,children:n})=>{const[l,o]=(0,i.useState)(!1),{t:d}=(0,x.Bd)("member"),{t:u}=(0,x.Bd)("chat"),{blockThisContact:m,removeFromContact:h,copyEmail:v,canCopyEmail:g,startChat:p,canRemove:f,canRemoveFromContact:j,canBlock:N,canRemoveFromChannel:A,removeFromChannel:E,removeUser:k,isAdmin:L,canUpdateRole:_,updateRole:M}=(0,C.A)({uid:t,cid:s});return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(w.A,{uid:t,visible:l,updateVisible:o}),(0,y.jsx)(c.Ay,{disabled:!e,visible:a,followCursor:"initial",interactive:!0,placement:"right-start",popperOptions:{strategy:"fixed"},onClickOutside:r,content:(0,y.jsx)(b.A,{hideMenu:r,items:[{title:d("send_msg"),handler:p},{title:u("remark"),handler:o.bind(null,!0)},g&&{title:d("copy_email"),handler:v},_&&{title:d("roles"),handler:M,subs:[{title:d("set_normal"),checked:!L,handler:M},{title:d("set_admin"),checked:L,handler:M}]},A&&{danger:!0,title:d("remove_from_channel"),handler:E},j&&{danger:!0,title:d("remove_from_contact"),handler:h},N&&{danger:!0,title:u("block"),handler:m},f&&{danger:!0,title:d("remove"),handler:k}].filter(Boolean)}),children:n},t)]})};var N=s(51612),A=s(5436),E=s(93061);const k=({cid:e,uid:t,dm:s=!1,interactive:a=!0,popover:r=!1,compact:n=!1,avatarSize:i=32,enableContextMenu:m=!1,enableNavToSetting:h=!1,...x})=>{const C=(0,l.Zp)(),{visible:b,handleContextMenuEvent:w,hideContextMenu:k}=(0,u.A)(),L=(0,d.GV)((e=>e.users.byId[t]),N.bN),_=(0,d.GV)((e=>{var t;return null===(t=e.authData.user)||void 0===t?void 0:t.uid}),N.bN),M=(0,d.GV)((e=>e.server.show_user_online_status),N.bN),V=()=>{C(`/chat/dm/${t}`)};if(!L)return null;const G=L.online||L.uid==_,O=(0,o.A)("relative flex items-center justify-start gap-2 rounded-lg select-none",a&&"md:hover:bg-gray-500/10",n?"p-0":"p-2",h&&"cursor-pointer"),D=(0,o.A)("text-sm text-gray-500 max-w-[190px] truncate font-semibold dark:text-white"),S=!!L.widget_id,$="absolute -bottom-[2.5px] -right-[2.5px] border-content rounded-full border-[1px] border-white dark:border-gray-300",I=(0,o.A)($,G?"bg-green-500":"bg-zinc-400",n?"w-[15px] h-[15px]":"w-3 h-3"),R=L.is_bot?(0,y.jsx)("div",{className:$,children:(0,y.jsx)(v,{className:n?"w-[15px] h-[15px]":"w-3 h-3"})}):M?(0,y.jsx)("div",{className:I}):null;return r?(0,y.jsx)(j,{cid:e,uid:t,enable:m,visible:b,hide:k,children:(0,y.jsx)(c.Ay,{inertia:!0,interactive:!0,placement:"left",trigger:"click",content:(0,y.jsx)(f.A,{uid:t,type:"card",cid:e}),children:(0,y.jsxs)("div",{className:O,onDoubleClick:s?V:void 0,onContextMenu:m?w:void 0,...x,children:[(0,y.jsxs)("div",{className:"cursor-pointer relative",style:{width:`${i}px`,height:`${i}px`},children:[(0,y.jsx)(p.A,{className:"w-full h-full rounded-full object-cover",width:i,height:i,src:L.avatar,name:L.name,alt:"avatar"}),R]}),!n&&(0,y.jsx)("span",{className:D,title:null===L||void 0===L?void 0:L.name,children:(0,y.jsx)(E.A,{uid:t,name:(null===L||void 0===L?void 0:L.name)||""})}),!n&&L.is_admin&&!L.is_bot&&(0,y.jsx)(g.A,{})]})})}):(0,y.jsx)(j,{cid:e,uid:t,enable:m,visible:b,hide:k,children:(0,y.jsxs)("div",{className:O,onClick:h?()=>{C(`/setting/dm/${t}/overview?f=/chat/dm/${t}`)}:void 0,onDoubleClick:s?V:void 0,onContextMenu:m?w:void 0,...x,children:[(0,y.jsxs)("div",{className:"cursor-pointer relative",style:{width:`${i}px`,height:`${i}px`},children:[(0,y.jsx)(p.A,{className:(0,A.cn)("size-full rounded-full object-cover",S&&"ring-2 ring-orange-500"),title:L.widget_id,width:i,height:i,src:L.avatar,name:L.name,alt:"avatar"}),R]}),!n&&(0,y.jsx)("span",{className:D,title:null===L||void 0===L?void 0:L.name,children:(0,y.jsx)(E.A,{uid:t,name:(null===L||void 0===L?void 0:L.name)||""})}),!n&&L.is_admin&&!L.is_bot&&(0,y.jsx)(g.A,{})]})})},L=(0,i.memo)(k,((e,t)=>e.uid==t.uid))},33139:(e,t,s)=>{s.d(t,{A:()=>o});var a,r,n,i=s(64131);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},l.apply(null,arguments)}const c=({title:e,titleId:t,...s},c)=>i.createElement("svg",l({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:c,"aria-labelledby":t},s),e?i.createElement("title",{id:t},e):null,a||(a=i.createElement("path",{d:"M0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8Z",fill:"url(#paint0_linear_14171_23293)"})),r||(r=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2431 5.96725C12.4162 5.86325 12.6357 5.87375 12.7982 5.99425C12.9602 6.11525 13.0342 6.32125 12.9857 6.51725L11.9857 10.5173C11.9297 10.7403 11.7297 10.8963 11.5002 10.8963H4.50018C4.27068 10.8963 4.07068 10.7397 4.01468 10.5173L3.01468 6.51725C2.96618 6.32125 3.04018 6.11525 3.20218 5.99425C3.36518 5.87425 3.58418 5.86375 3.75768 5.96725L5.84918 7.22225L7.58468 4.61875C7.59654 4.60096 7.61307 4.58921 7.62965 4.57743C7.63964 4.57033 7.64966 4.56321 7.65868 4.55475L7.17718 4.07275C7.08018 3.97575 7.08018 3.81625 7.17718 3.71925L7.82368 3.07275C7.92068 2.97575 8.08018 2.97575 8.17718 3.07275L8.82368 3.71925C8.92068 3.81625 8.92068 3.97575 8.82368 4.07275L8.34218 4.55475C8.3512 4.56338 8.3614 4.57062 8.37161 4.57787C8.38802 4.58951 8.40447 4.60119 8.41618 4.61875L10.1517 7.22225L12.2431 5.96725ZM4.00025 11.3962H12.0002V12.3963H4.00025V11.3962Z",fill:"#ECE9FE"})),n||(n=i.createElement("defs",null,i.createElement("linearGradient",{id:"paint0_linear_14171_23293",x1:0,y1:0,x2:16,y2:-1.66785e-9,gradientUnits:"userSpaceOnUse"},i.createElement("stop",{stopColor:"#7F56D9"}),i.createElement("stop",{offset:1,stopColor:"#9E77ED"}))))),o=(0,i.forwardRef)(c)},40832:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(64131),r=s(76221),n=s(68812),i=s(51612),l=s(5436);function c(){const[e,t]=(0,a.useState)(""),s=(0,n.GV)((e=>{var t;return null===(t=e.authData.user)||void 0===t?void 0:t.is_admin}),i.bN),c=(0,n.GV)((e=>Object.values(e.users.byId)),i.bN),o=(0,n.GV)((e=>e.server.contact_verification_enable),i.bN),[d,u]=(0,a.useState)([]),m=o&&!s?c.filter((e=>"added"==e.status)):c;(0,a.useEffect)((()=>{if(e){let t=["",(0,r.escapeRegExp)(e.toLowerCase()),""].join(".*"),s=new RegExp(t);u((0,l.g4)(m.filter((e=>!!e&&s.test(e.name.toLowerCase())))))}else u((0,l.g4)(m))}),[e,m.length]);return{input:e,users:d,uids:d.map((e=>e.uid)),updateInput:e=>{t(e)}}}},45891:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(22404),r=s(82979);const n=({compact:e=!1,title:t="",description:s="",buttons:n,children:i,className:l})=>(0,r.jsxs)("div",{className:(0,a.A)("rounded-lg bg-white dark:bg-gray-900 drop-shadow",e?"p-4 md:min-w-[406px] text-left":"p-5 md:p-8 md:min-w-[440px] text-center",l),children:[t&&(0,r.jsx)("h3",{className:"text-xl text-gray-600 dark:text-white mb-4 font-semibold",children:t}),s&&(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-100 mb-2",children:s}),i,n&&(0,r.jsx)("div",{className:"pt-4 w-full flex justify-end gap-4 items-center",children:n})]})},61694:(e,t,s)=>{s.d(t,{A:()=>l});var a,r=s(64131);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n.apply(null,arguments)}const i=({title:e,titleId:t,...s},i)=>r.createElement("svg",n({width:14,height:15,viewBox:"0 0 14 15",fill:"black",xmlns:"http://www.w3.org/2000/svg",ref:i,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,a||(a=r.createElement("path",{d:"M7 6.7929L10.5355 3.25736C10.7308 3.0621 11.0474 3.0621 11.2426 3.25736C11.4379 3.45262 11.4379 3.76921 11.2426 3.96447L7.70711 7.5L11.2426 11.0355C11.4379 11.2308 11.4379 11.5474 11.2426 11.7426C11.0474 11.9379 10.7308 11.9379 10.5355 11.7426L7 8.20711L3.46447 11.7426C3.26921 11.9379 2.95262 11.9379 2.75736 11.7426C2.5621 11.5474 2.5621 11.2308 2.75736 11.0355L6.2929 7.5L2.75736 3.96447C2.5621 3.76921 2.5621 3.45262 2.75736 3.25736C2.95262 3.0621 3.26921 3.0621 3.46447 3.25736L7 6.7929Z",fillOpacity:.8}))),l=(0,r.forwardRef)(i)},71995:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(75111),r=s(68812),n=s(5436),i=s(64131),l=s(25293),c=s(79574),o=s(51612);const d=e=>{const{t:t}=(0,c.Bd)(),s=Object.assign({},{successTip:!0,key:""},e),{refetch:d}=(0,a.Mv)(),[u,{isSuccess:m}]=(0,a.u3)(),h=(0,r.GV)((e=>{var t;return null!==(t=e.server.ext_setting)&&void 0!==t?t:"{}"}),o.bN);let v={};try{v=JSON.parse(h)}catch(p){console.warn(p)}const g={string:"",boolean:!1};return(0,i.useEffect)((()=>{m&&d()}),[m]),(0,i.useEffect)((()=>{m&&s.successTip&&l.Ay.success(t("tip.update"))}),[m,s.successTip]),{jsonSetting:h,setting:v,getExtSetting:(e,t)=>{var a;const r=null!==e&&void 0!==e?e:s.key,i=null!==t&&void 0!==t?t:"boolean";return null!==(a=(0,n.zk)(h,r))&&void 0!==a?a:g[i]},updateExtSetting:(e,t)=>{const s=(0,n.Ub)(h,{[e]:t});u({ext_setting:s})}}}},73709:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(82979);function r(e){const{className:t}=e;return(0,a.jsx)("input",{readOnly:!0,...e,type:"checkbox",className:`checkbox w-5 h-5 rounded-md border border-solid border-slate-300 checked:border-primary-400 disabled:opacity-40 ${t}`})}},74903:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(64131),r=s(30001),n=s(63473),i=s(85644),l=s(82979);function c(e="right-start"){const[t,s]=(0,a.useState)(!1),[c,o]=(0,a.useState)({x:0,y:0}),d=()=>{s(!1)};return{ContextMenu:({key:e,items:s,children:a})=>(0,l.jsx)(r.Ay,{visible:t,followCursor:"initial",interactive:!0,placement:"right-start",popperOptions:{strategy:"fixed"},onClickOutside:d,content:(0,l.jsx)(i.A,{hideMenu:d,items:s}),children:a},e),offset:c,visible:t,hideContextMenu:d,handleContextMenuEvent:t=>{(0,n.cJ)(),t.preventDefault();const{currentTarget:a,clientX:r,clientY:i}=t,{left:l,top:c,width:d,height:u}=a.getBoundingClientRect();let m,h;"right-start"==e?(m=r-(l+d),h=c+u-i):(m=r-l,h=c-i),o({x:m,y:h}),s(!0)}}}},82940:(e,t,s)=>{s.d(t,{A:()=>u});s(64131);var a=s(26634),r=s(22404),n=s(6712),i=s(96910),l=s(92851),c=s(68812),o=s(51612),d=s(82979);const u=()=>{const e=(0,a.RQ)("/"),{pathname:t}=(0,a.zy)(),s=(0,a.RQ)("/chat"),u=(0,a.RQ)("/chat/dm/:user_id"),m=(0,a.RQ)("/chat/channel/:channel_id"),{chat:h,user:v}=(0,c.GV)((e=>e.ui.rememberedNavs),o.bN),g="flex",p=e||t.startsWith("/chat"),f=!!u||!!m,x=s?"/chat":h||"/chat",C=v||"/users";return(0,d.jsxs)("ul",{className:(0,r.A)("flex justify-around py-2 fixed bottom-0 left-0 w-full bg-gray-100 dark:bg-gray-800 md:hidden",f&&"hidden"),children:[(0,d.jsx)("li",{children:(0,d.jsx)(a.k2,{className:()=>`${g}`,to:x,children:({isActive:e})=>{const t=e||p;return(0,d.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,d.jsx)(n.A,{className:t?"fill-primary-500":"fill-gray-500"}),(0,d.jsx)("span",{className:(0,r.A)("text-xs",t?"text-primary-500":"text-gray-500"),children:"Chats"})]})}})}),(0,d.jsx)("li",{children:(0,d.jsx)(a.k2,{className:()=>`${g}`,to:C,children:({isActive:e})=>(0,d.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,d.jsx)(l.A,{className:e?"fill-primary-500":"fill-gray-500"}),(0,d.jsx)("span",{className:(0,r.A)("text-xs",e?"text-primary-500":"text-gray-500"),children:"Contacts"})]})})}),(0,d.jsx)("li",{children:(0,d.jsx)(a.k2,{className:()=>`${g}`,to:"/setting",children:({isActive:e})=>(0,d.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,d.jsx)(i.A,{className:(0,r.A)("w-6 h-6",e?"fill-primary-500":"fill-gray-500")}),(0,d.jsx)("span",{className:(0,r.A)("text-xs",e?"text-primary-500":"text-gray-500"),children:"Settings"})]})})})]})}},84619:(e,t,s)=>{s.r(t),s.d(t,{default:()=>fe});var a=s(64131),r=s(79574),n=s(51612),i=s(26634),l=s(24227),c=s(68812),o=s(33854),d=s(83051);var u=s(61694),m=s(1393),h=s(77338),v=s(82979);const g=({handleInstall:e,closePrompt:t})=>{const{t:s}=(0,r.Bd)();return(0,v.jsx)(m.A,{mask:!1,children:(0,v.jsxs)("div",{className:"relative pointer-events-auto mt-4 w-[406px] p-4 rounded-md bg-white dark:bg-gray-900 shadow-md flex flex-col gap-3",children:[(0,v.jsx)(u.A,{className:"absolute top-4 right-4 cursor-pointer",onClick:t}),(0,v.jsxs)("div",{className:"flex flex-col gap-4 text-gray-600 dark:text-gray-300",children:[(0,v.jsx)("h2",{className:"font-semibold",children:s("tip.pwa_install_title")}),(0,v.jsx)("p",{className:"text-sm",children:s("tip.pwa_install_desc")})]}),(0,v.jsxs)("div",{className:"w-full flex justify-end gap-4",children:[(0,v.jsx)(h.A,{className:"ghost cancel small",onClick:t,children:s("action.cancel")}),(0,v.jsx)(h.A,{className:"main small",onClick:e,children:s("action.install")})]})]})})},p=()=>{const{setCanceled:e,prompted:t,setDeferredPrompt:s,showPrompt:r}=function(){const e=(0,a.useRef)(null),t=t=>{e.current=t};return(0,a.useEffect)((()=>{const e=e=>{e.preventDefault(),t(e)};return window.addEventListener("beforeinstallprompt",e,!0),()=>{window.removeEventListener("beforeinstallprompt",e,!0)}}),[]),{setCanceled:()=>{localStorage.setItem(d.sM,"true")},prompted:!!localStorage.getItem(d.sM),resetPrompt:()=>{localStorage.removeItem(d.sM),e.current=null},deferredPrompt:e.current,setDeferredPrompt:t,showPrompt:async()=>{if(!e.current)return;e.current.prompt();const{outcome:s}=await e.current.userChoice;t(null)}}}(),[n,i]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=e=>{e.preventDefault(),s(e),i(!0)},t=()=>{s(null),i(!1)};return window.addEventListener("beforeinstallprompt",e,!0),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e,!0),window.removeEventListener("appinstalled",t)}}),[]);return!n||t?null:(0,v.jsx)(g,{handleInstall:async()=>{i(!1),await r()},closePrompt:async()=>{e(),i(!1)}})};var f=s(13370),x=s(71464);let C=!1,b=!1;const w=()=>{const e=(0,i.Zp)(),t=(0,x.A)(d.Er),[s]=(0,f.pz)();return(0,a.useEffect)((()=>{(async e=>{if(e&&!b&&!C)try{b=!0,await s(e),C=!0}catch{b=!1,C=!0}})(t)}),[t]),(0,a.useEffect)((()=>{var t;const s=t=>{const{newPath:s}=t.data;s&&document.hidden&&e(s)};return null===(t=navigator.serviceWorker)||void 0===t||t.addEventListener("message",s),()=>{var e;null===(e=navigator.serviceWorker)||void 0===e||e.removeEventListener("message",s)}}),[]),null},y=(0,a.memo)(w);var j=s(25293),N=s(22241),A=s(64655),E=s(45891);const k=({reasonType:e="role_changed"})=>{const t=(0,n.wA)(),{t:s}=(0,r.Bd)("auth"),{t:i}=(0,r.Bd)(),{logout:l,exited:c,exiting:o}=(0,A.A)();return(0,a.useEffect)((()=>{c&&j.Ay.success(i("tip.logout"))}),[c]),(0,v.jsx)(m.A,{id:"modal-modal",children:(0,v.jsx)(E.A,{buttons:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(h.A,{className:"cancel",onClick:()=>{t((0,N.yG)(!1))},children:s("logout.later")}),(0,v.jsx)(h.A,{onClick:()=>{l()},className:"danger",children:o?"Logging out":i("action.re_login")})]}),children:(0,v.jsx)("div",{className:"text-sm text-gray-400 flex justify-end items-center",children:s(`logout.${e}`)})})})};var L=s(79527),_=s(89949);let M=0,V="";const G=()=>{const e=(0,c.GV)((e=>{var t,s;return null!==(t=null===(s=e.authData.user)||void 0===s?void 0:s.uid)&&void 0!==t?t:0}),n.bN),t=(0,c.GV)((e=>e.footprint.muteChannels),n.bN),s=(0,c.GV)((e=>e.footprint.muteUsers),n.bN),r=(0,c.GV)((e=>e.footprint.readChannels),n.bN),i=(0,c.GV)((e=>e.footprint.readUsers),n.bN),l=(0,c.GV)((e=>e.users.byId),n.bN),o=(0,c.GV)((e=>e.userMessage.byId),n.bN),d=(0,c.GV)((e=>e.channelMessage),n.bN),u=(0,c.GV)((e=>e.message),n.bN);return(0,a.useEffect)((()=>{if(0===e)return void(V&&(document.title=V));M=0,Object.entries(o).forEach((([t,a])=>{if(!s[+t]&&l[+t]){const{unreads:s=0}=(0,_.Ay)({mids:a,readIndex:i[+t],messageData:u,loginUid:e});M+=s}})),Object.entries(d).map((([s,a])=>{if(!t[+s]){const{unreads:t=0}=(0,_.Ay)({mids:a,readIndex:r[+s],messageData:u,loginUid:e});M+=t}}));const a=()=>{document.hidden,document.hidden?(V=document.title,M>0&&(document.title=`[${M}]-${V}`)):document.title=V};return document.addEventListener("visibilitychange",a),document.hidden&&M>0&&(document.title=`[${M}]-${V}`),()=>{document.removeEventListener("visibilitychange",a)}}),[l,o,d,r,u,e,i,t,s]),null};var O=s(78302),D=s(78117),S=s.n(D),$=s(57323),I=s(72889),R=s(76305),B=s(386),H=s(97862),Z=s(85475),P=s(46340),F=s(5377),T=s(66625),U=s(14234),z=s(19545);const Q=()=>{const[e,t]=(0,a.useState)(!1),s=(0,n.wA)();return{rehydrate:async()=>{const e={channels:[],users:[],fileMessage:{},channelMessage:{},userMessage:{},reactionMessage:{},message:{replying:{}},footprint:{},ui:{},server:{}};if(!window.CACHE)return void t(!0);const a=Object.keys(window.CACHE);await Promise.all(a.map((t=>{var s;return null===(s=window.CACHE[t])||void 0===s?void 0:s.iterate(((s,a)=>{switch(t){case"channels":s&&e.channels.push(s);break;case"users":s&&e.users.push(s);break;case"footprint":e.footprint[a]=s;break;case"ui":e.ui[a]=s;break;case"messageChannel":e.channelMessage[a]=s;break;case"messageFile":e.fileMessage[a]=s||[];break;case"messageDM":e.userMessage[a]=s;break;case"messageReaction":e.reactionMessage[a]=s;break;case"message":e.message[a]=s;break;case"server":e.server[a]=s}}))}))),s((0,z.yi)(e.users)),s((0,U.Ts)(e.server)),s((0,R.I9)(e.channels)),s((0,P.fl)(e.fileMessage.list)),s((0,Z.oT)(e.channelMessage)),s((0,T.Ur)(e.userMessage)),s((0,H.fu)(e.message)),s((0,B.hh)(e.footprint)),s((0,l.eV)(e.ui)),s((0,F.Is)(e.reactionMessage)),t(!0)},rehydrated:e}};(0,I.extendPrototype)($);const W=[{storeName:"channels",description:"store channel list"},{storeName:"users",description:"store user list"},{storeName:"messageDM",description:"store DM message with IDs"},{storeName:"messageChannel",description:"store channel message with IDs"},{storeName:"message",description:"store message with key-val full data"},{storeName:"messageFile",description:"store file message list"},{storeName:"messageArchive",description:"store archive message"},{storeName:"messageReaction",description:"store message reaction with key-val full data"},{storeName:"footprint",description:"store user visit data"},{storeName:"server",description:"store server data"},{storeName:"ui",description:"store UI state"}],J=()=>{const e=localStorage.getItem(d.n9)||"";if(!e)return;const t=`local_db_${e}_v_${d.yL.split(".").join("_")}`;window.CACHE={},W.forEach((({storeName:e,description:s})=>{window.CACHE[e]=$.createInstance({name:t,storeName:e,description:s})}))};var Y=s(20657),q=s(75111),X=s(42687),K=s(33162),ee=s(7714);let te=!1;var se,ae=s(29626),re=s(6712);function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},ne.apply(null,arguments)}const ie=({title:e,titleId:t,...s},r)=>a.createElement("svg",ne({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,se||(se=a.createElement("path",{d:"M13.821 6.5H19.75C20.8867 6.5 21.8266 7.34297 21.9785 8.43788L21.9948 8.59595L22 8.75V17.75C22 18.9409 21.0748 19.9156 19.904 19.9948L19.75 20H4.25C3.05914 20 2.08436 19.0748 2.00519 17.904L2 17.75V10.499L8.20693 10.5L8.40335 10.4914C8.79396 10.4572 9.16896 10.3214 9.49094 10.0977L9.64734 9.9785L13.821 6.5ZM8.20693 4C8.66749 4 9.1153 4.14129 9.49094 4.40235L9.64734 4.5215L11.75 6.273L8.68706 8.82617L8.60221 8.88738C8.51363 8.94232 8.41452 8.9782 8.31129 8.9927L8.20693 9L2 8.999V6.25C2 5.05914 2.92516 4.08436 4.09595 4.00519L4.25 4H8.20693Z"}))),le=(0,a.forwardRef)(ie);var ce=s(92851),oe=s(96910);const de=()=>{const{pathname:e}=(0,i.zy)();return(0,v.jsx)("ul",{className:"flex flex-col absolute left-0 bottom-0 w-full px-3 py-2",children:(0,v.jsx)("li",{className:"cursor-pointer flex items-center p-2.5 gap-2.5 link_navs",children:(0,v.jsx)(i.k2,{className:"link",to:`/setting/overview?f=${e}`,children:(0,v.jsx)(L.A,{placement:"right",tip:"Settings",children:(0,v.jsx)(oe.A,{className:"w-6 h-6 dark:fill-gray-400"})})})})})};var ue=s(82940),me=s(63155);const he=({uid:e})=>{const{pathname:t}=(0,i.zy)(),s=(0,c.GV)((t=>t.users.byId[e]),n.bN);return s?(0,v.jsx)("div",{className:"px-3 py-2.5 invisible md:visible",children:(0,v.jsx)(i.k2,{to:`/setting/my_account?f=${t}`,children:(0,v.jsx)("div",{className:"w-8 h-8",children:(0,v.jsx)(me.A,{className:" object-cover w-full h-full rounded-full",width:32,height:32,src:s.avatar,name:s.name})})})}):null};var ve=s(22404);const ge=()=>{const e=(0,c.GV)((e=>e.ui.SSEStatus),n.bN);return(0,v.jsx)("aside",{className:"fixed right-2 bottom-2",children:(0,v.jsx)("div",{className:(0,ve.A)("w-1 h-1 rounded-full","connected"===e&&"bg-green-500","disconnected"===e&&"bg-red-500","reconnecting"===e&&"bg-blue-500","connecting"===e&&"bg-yellow-500")})})};function pe(){const{t:e}=(0,r.Bd)(),t=(0,n.wA)(),s=(0,i.RQ)("/"),d=(0,i.RQ)("/chat"),{pathname:u}=(0,i.zy)(),m=(0,c.GV)((e=>e.authData.roleChanged),n.bN),h=(0,c.GV)((e=>e.authData.guest),n.bN),g=(0,c.GV)((e=>{var t,s;return null!==(t=null===(s=e.authData.user)||void 0===s?void 0:s.uid)&&void 0!==t?t:0}),n.bN),f=(0,c.GV)((e=>{var t,s;return null!==(t=null===(s=e.authData.user)||void 0===s?void 0:s.is_admin)&&void 0!==t&&t}),n.bN),{chat:x,user:C}=(0,c.GV)((e=>e.ui.rememberedNavs),n.bN),{success:b}=function(){const{isLoading:e}=(0,K.A)(!1),[t]=(0,Y.V0)(),{rehydrate:s,rehydrated:r}=Q(),i=(0,c.GV)((e=>e.ui.ready),n.bN),l=(0,c.GV)((e=>{var t;return null===(t=e.authData.user)||void 0===t?void 0:t.uid}),n.bN),o=(0,c.GV)((e=>e.server.contact_verification_enable),n.bN),d=(0,c.GV)((e=>{var t;return null!==(t=e.authData.expireTime)&&void 0!==t?t:+new Date}),n.bN),u=(0,c.GV)((e=>e.channels.ids),n.bN),m=(0,c.GV)((e=>e.authData.token),n.bN),h=(0,c.GV)((e=>e.authData.guest),n.bN),v=(0,c.GV)((e=>e.channelMessage),n.bN),{startStreaming:g,stopStreaming:p}=(0,ee.A)(),[f,{isLoading:x,isSuccess:C,isError:b,data:w}]=(0,Y.JY)(),[y,{isLoading:j,isSuccess:N,isError:A,data:E}]=(0,X.Ii)(),[k,{data:L}]=(0,X.F2)(),[_,{data:M,isSuccess:V,isLoading:G}]=(0,q.hC)(),[O]=(0,q.qp)();(0,a.useEffect)((()=>{J(),s(),_()}),[]),(0,a.useEffect)((()=>{h&&u.length>0&&!te&&(u.filter((e=>!v[e])).forEach((e=>{e&&t({id:e,limit:50})})),te=!0)}),[u,v,h]),(0,a.useEffect)((()=>{r&&M&&(y().then((()=>{h||k()})),f(),O())}),[r,M,h]);const D=S()().isAfter(new Date(d-2e4)),$=!!l&&r&&!!m&&!D&&!i;return(0,a.useEffect)((()=>{$&&(p(),setTimeout((()=>{g()}),100))}),[$]),{loading:j||x||!r||e||G,error:A&&b,success:N&&C&&V,data:{users:o?L:E,favorites:w}}}();if((0,a.useEffect)((()=>{d&&t((0,l.u2)({key:"chat",path:"/chat"}))}),[d]),console.info("preload success",b),!b)return(0,v.jsx)(o.A,{reload:!0,fullscreen:!0,context:"home-route"});const w=u.startsWith("/setting"),j=s||u.startsWith("/chat");if(w)return(0,v.jsx)(i.sv,{});const N=d?"/chat":x||"/chat",A=C||"/users",E="flex items-center gap-2.5 px-3 py-2 font-semibold text-sm text-gray-600 rounded-lg md:hover:bg-gray-800/10";return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ge,{}),m&&(0,v.jsx)(k,{}),!h&&(0,v.jsx)(G,{}),!h&&(0,v.jsx)(O.A,{}),(0,v.jsx)(p,{}),!h&&(0,v.jsx)(y,{}),(0,v.jsxs)("div",{className:"vocechat-container flex w-screen h-screen bg-neutral-100 dark:bg-neutral-900",children:[!h&&(0,v.jsxs)("div",{className:"hidden md:flex h-full flex-col items-center relative w-16 transition-all",children:[g&&(0,v.jsx)(he,{uid:g}),(0,v.jsxs)("nav",{className:"flex flex-col gap-1 px-3 py-6",children:[(0,v.jsx)(i.k2,{className:({isActive:e})=>`${E} ${e||j?"bg-primary-400 md:hover:bg-primary-400":""}`,to:N,children:({isActive:t})=>(0,v.jsx)(L.A,{tip:e("chat"),children:(0,v.jsx)(re.A,{className:t||j?"fill-white":""})})}),(0,v.jsx)(i.k2,{className:({isActive:e})=>`${E} ${e?"bg-primary-400 md:hover:bg-primary-400":""}`,to:A,children:({isActive:t})=>(0,v.jsx)(L.A,{tip:e("members"),children:(0,v.jsx)(ce.A,{className:t?"fill-white":""})})}),(0,v.jsx)(i.k2,{className:({isActive:e})=>`${E} ${e?"bg-primary-400 md:hover:bg-primary-400":""}`,to:"/favs",children:({isActive:t})=>(0,v.jsx)(L.A,{tip:e("favs"),children:(0,v.jsx)(ae.A,{className:t?"fill-white":""})})}),f&&(0,v.jsx)(i.k2,{className:({isActive:e})=>`${E} ${e?"bg-primary-400 md:hover:bg-primary-400":""}`,to:"/files",children:({isActive:t})=>(0,v.jsx)(L.A,{tip:e("files"),children:(0,v.jsx)(le,{className:t?"fill-white":""})})})]}),(0,v.jsx)(de,{})]}),(0,v.jsx)("div",{className:"h-full flex flex-col w-full",children:(0,v.jsx)(i.sv,{})})]}),!h&&(0,v.jsx)(ue.A,{})]})}const fe=(0,a.memo)(pe)},92851:(e,t,s)=>{s.d(t,{A:()=>l});var a,r=s(64131);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n.apply(null,arguments)}const i=({title:e,titleId:t,...s},i)=>r.createElement("svg",n({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:i,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,a||(a=r.createElement("path",{d:"M17.7541 13.9999C18.9961 13.9999 20.0029 15.0068 20.0029 16.2488V17.1673C20.0029 17.7406 19.8237 18.2997 19.4903 18.7662C17.9445 20.9294 15.4202 22.0011 11.9999 22.0011C8.57891 22.0011 6.05595 20.9289 4.51379 18.7646C4.18182 18.2987 4.00342 17.7409 4.00342 17.1688V16.2488C4.00342 15.0068 5.01027 13.9999 6.25229 13.9999H17.7541ZM11.9999 2.00464C14.7613 2.00464 16.9999 4.24321 16.9999 7.00464C16.9999 9.76606 14.7613 12.0046 11.9999 12.0046C9.23845 12.0046 6.99988 9.76606 6.99988 7.00464C6.99988 4.24321 9.23845 2.00464 11.9999 2.00464Z"}))),l=(0,r.forwardRef)(i)},93061:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(68812),r=s(82979);const n=({uid:e,name:t="",showName:s=!0})=>{const n=(0,a.GV)((t=>t.footprint.remarkMap[e]));return n?(0,r.jsxs)(r.Fragment,{children:[n," ",s?`(${t})`:null]}):t}},96910:(e,t,s)=>{s.d(t,{A:()=>l});var a,r=s(64131);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n.apply(null,arguments)}const i=({title:e,titleId:t,...s},i)=>r.createElement("svg",n({width:16,height:16,viewBox:"0 0 16 16",fill:"#344054",xmlns:"http://www.w3.org/2000/svg",ref:i,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,a||(a=r.createElement("path",{d:"M2.2672 6.15302C2.52892 5.34708 2.96005 4.60729 3.52891 3.98033C3.62511 3.87431 3.77603 3.83652 3.91115 3.88463L5.27062 4.36863C5.6392 4.49978 6.04476 4.30859 6.17647 3.9416C6.18942 3.90551 6.1994 3.86844 6.20629 3.8308L6.46529 2.41527C6.49104 2.27452 6.5996 2.1632 6.74013 2.13341C7.1513 2.04627 7.57289 2.00195 8 2.00195C8.42685 2.00195 8.84818 2.04621 9.25912 2.13325C9.39961 2.16301 9.50816 2.27427 9.53397 2.41496L9.7937 3.83074C9.86392 4.21413 10.233 4.46825 10.618 4.39833C10.6559 4.39146 10.6931 4.38153 10.7293 4.36865L12.0888 3.88463C12.224 3.83652 12.3749 3.87431 12.4711 3.98033C13.04 4.60729 13.4711 5.34708 13.7328 6.15302C13.777 6.28899 13.7344 6.43805 13.625 6.53053L12.5231 7.46205C12.2247 7.7143 12.1882 8.1596 12.4416 8.45667C12.4665 8.48589 12.4937 8.51303 12.5231 8.53782L13.625 9.46935C13.7344 9.56183 13.777 9.71089 13.7328 9.84685C13.4711 10.6528 13.04 11.3926 12.4711 12.0196C12.3749 12.1256 12.224 12.1634 12.0888 12.1153L10.7294 11.6312C10.3608 11.5001 9.95524 11.6913 9.82353 12.0583C9.81058 12.0944 9.8006 12.1314 9.79368 12.1692L9.53397 13.5849C9.50816 13.7256 9.39961 13.8369 9.25912 13.8666C8.84818 13.9537 8.42685 13.9979 8 13.9979C7.57289 13.9979 7.1513 13.9536 6.74013 13.8665C6.5996 13.8367 6.49104 13.7254 6.46529 13.5846L6.2063 12.1691C6.13608 11.7857 5.76701 11.5316 5.38196 11.6015C5.3441 11.6084 5.30687 11.6184 5.27068 11.6312L3.91115 12.1153C3.77603 12.1634 3.62511 12.1256 3.52891 12.0196C2.96005 11.3926 2.52892 10.6528 2.2672 9.84685C2.22305 9.71089 2.26562 9.56183 2.37502 9.46935L3.47693 8.53783C3.77528 8.28558 3.81177 7.84027 3.55843 7.5432C3.53352 7.51399 3.50626 7.48685 3.47694 7.46206L2.37502 6.53053C2.26562 6.43805 2.22305 6.28899 2.2672 6.15302ZM6.24988 7.99988C6.24988 8.96638 7.03338 9.74988 7.99988 9.74988C8.96638 9.74988 9.74988 8.96638 9.74988 7.99988C9.74988 7.03338 8.96638 6.24988 7.99988 6.24988C7.03338 6.24988 6.24988 7.03338 6.24988 7.99988Z"}))),l=(0,r.forwardRef)(i)}}]);