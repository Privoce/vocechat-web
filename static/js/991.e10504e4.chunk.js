"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[991],{13991:(e,a,t)=>{t.r(a),t.d(a,{default:()=>k});var s=t(91118),n=t(90184),r=t(23558),o=t(31210),c=t(86938),i=t(32639),l=t(56966),d=t(69259),m=t(72421),x=t(28512),u=t(76013),h=t(68702),g=t(71040),p=t(86560),f=t(21153),w=t(45646);function v(){return(0,w.jsxs)("div",{className:"flex flex-col items-center",children:[(0,w.jsx)("div",{className:"font-bold text-3xl text-gray-800 dark:text-white mt-3",children:"Magic link Sent"}),(0,w.jsx)("p",{className:"text-center text-gray-400 dark:text-gray-300 mb-6",children:"Login to your email client, and continue next step"}),(0,w.jsx)("p",{className:"text-center text-gray-400 dark:text-gray-300",children:"You can close this window now."})]})}var y=t(76504);function j({token:e}){var a;const{t:t}=(0,r.Bd)("auth");let[n]=(0,c.ok)(new URLSearchParams(location.search));const o=null!==(a=n.get("ctx"))&&void 0!==a?a:"app";return(0,s.useEffect)((()=>{(0,p.Fr)()&&e&&"app"==o&&(location.href=`https://join.voce.chat/download?link=${encodeURIComponent(`${location.origin}?magic_token=${e}`)}`)}),[e,o]),(0,w.jsxs)("div",{className:"flex gap-1 mt-7 text-sm text-slate-500 dark:text-gray-100 justify-center",children:[(0,w.jsx)("span",{children:t("reg.have_account")}),(0,w.jsx)(c.k2,{to:"/login",className:"text-primary-400 cursor-pointer",children:t("sign_in")})]})}function k(){const[e]=(0,c.ok)(new URLSearchParams(location.search)),a=e.get("ctx"),t=(0,x.GV)((e=>e.server.name),o.bN),{t:k}=(0,r.Bd)("auth"),{t:_}=(0,r.Bd)(),[N,{isLoading:b,data:A,isSuccess:S}]=(0,l.G6)(),L=(0,o.wA)(),{token:P}=(0,y.useMagicToken)(),[C,{isLoading:E,data:B,isSuccess:$}]=(0,l.ge)(),[R,{isLoading:T}]=(0,l.un)(),{data:q,isSuccess:F}=(0,d.T7)(),M=(0,c.Zp)(),[U,I]=(0,s.useState)({name:"",email:"",password:"",confirmPassword:""});P&&localStorage.setItem(i.wi,P),(0,s.useEffect)((()=>{"web"!==a&&(0,p.Fr)()&&P&&M(`/invite_mobile/${P}`)}),[a,P]),(0,s.useEffect)((()=>{if(S&&A){const{new_magic_token:e,mail_is_sent:a}=A;!a&&e&&M(`/register/set_name?magic_token=${e}`)}}),[S,A]),(0,s.useEffect)((()=>{$&&B&&(n.Ay.success(_("tip.reg")),L((0,m.vd)(B)),location.reload())}),[$,B]);const O=e=>{const{type:a}=e.target.dataset,{value:t}=e.target;I((e=>(e[a]=t,{...e})))};if(!F)return null;const{who_can_sign_up:G}=q;if("EveryOne"!==G&&!P)return(0,w.jsx)("span",{className:"dark:text-white",children:"Sign up method is updated to Invitation Link Only"});const{name:z,email:D,password:K,confirmPassword:Q}=U;if(null!==A&&void 0!==A&&A.mail_is_sent)return(0,w.jsx)(v,{});const V=E||b||T;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"flex-center flex-col pb-6",children:[(0,w.jsx)("img",{src:`${i.Ay}/resource/organization/logo`,alt:"logo",className:"w-14 h-14 md:mb-7 rounded-full"}),(0,w.jsx)("h2",{className:"font-semibold text-center text-balance text-2xl text-gray-800 dark:text-white",children:k("reg.title",{name:t})})]}),(0,w.jsxs)("form",{className:"flex flex-col gap-5 md:min-w-[360px] w-full",onSubmit:async e=>{e.preventDefault();const{name:a,email:t,password:s,confirmPassword:r}=U;if(s!==r)return void n.Ay.error("Not Same Password!");const{data:o}=await R(t);o?P?N({magic_token:P,email:t,password:s}):C({name:a,email:t,password:s}):n.Ay.error("Email already registered!")},autoSave:"false",autoComplete:"true",children:[!P&&(0,w.jsx)(g.A,{className:"large",name:"name",value:z,required:!0,type:"name",placeholder:k("placeholder_name"),"data-type":"name",onChange:O}),(0,w.jsx)(g.A,{className:"large",name:"email",value:D,required:!0,type:"email",placeholder:k("placeholder_email"),"data-type":"email",onChange:O}),(0,w.jsx)(g.A,{className:"large",type:"password",value:K,name:"password",required:!0,minLength:6,"data-type":"password",onChange:O,placeholder:k("placeholder_pwd")}),(0,w.jsx)(g.A,{className:"large",required:!0,onBlur:()=>{const{password:e,confirmPassword:a}=U;e!==a&&n.Ay.error("Not Same Password!")},type:"password",minLength:6,name:"confirmPassword",value:Q,"data-type":"confirmPassword",onChange:O,placeholder:k("placeholder_confirm_pwd")}),(0,w.jsx)(h.A,{type:"submit",disabled:V,children:k(V?"signing_up":"sign_up")})]}),(0,w.jsx)(u.A,{content:"OR"}),(0,w.jsx)("div",{className:"socials flex flex-col gap-3 py-3 empty:hidden",children:(0,w.jsx)(f.A,{type:"register"})}),(0,w.jsx)(j,{token:P})]})}},76504:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m,useMagicToken:()=>x});var s=t(91118),n=t(86938),r=t(56966),o=t(23558),c=t(45646);function i(){const{t:e}=(0,o.Bd)("auth",{keyPrefix:"magic_link_expire"});return(0,c.jsxs)("div",{className:"flex flex-col items-center",children:[(0,c.jsx)("div",{className:"font-bold text-3xl text-gray-800 dark:text-white mt-3",children:e("title")}),(0,c.jsx)("p",{className:"text-center text-gray-400 mb-6",children:e("desc")}),(0,c.jsx)("p",{className:"text-center text-gray-400",children:e("desc_close")})]})}var l=t(37638),d=t(213);function m(){var e;const[a,{data:t,isLoading:o}]=(0,r.BQ)(),[m,x]=(0,s.useState)("");let[u]=(0,n.ok)(new URLSearchParams(location.search));const h=null!==(e=u.get("magic_token"))&&void 0!==e?e:"";return(0,s.useEffect)((()=>{h&&a(h)}),[h]),(0,s.useEffect)((()=>{t&&x(h)}),[t,h]),o?(0,c.jsx)("div",{className:"dark:text-gray-100",children:"Checking Magic Link..."}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"flex-center h-screen overflow-x-hidden overflow-y-auto dark:bg-gray-700",children:(0,c.jsxs)("div",{className:"py-8 px-10 shadow-md rounded-xl max-h-[95vh] overflow-y-auto overflow-x-hidden",children:[h?t?(0,c.jsx)(n.sv,{context:{token:m}}):(0,c.jsx)(i,{}):(0,c.jsx)(n.sv,{context:{token:m}}),(0,c.jsx)(d.A,{})]})}),(0,c.jsx)(l.A,{})]})}function x(){return(0,n.KC)()}}}]);