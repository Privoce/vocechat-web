"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[278],{33162:(e,s,t)=>{t.d(s,{A:()=>l});var c=t(64131),i=t(75111),n=t(68812),a=t(51612),r=t(14234);const l=(e=!1)=>{var s;const t=(0,a.wA)(),l=(0,n.GV)((e=>e.users.ids.length),a.bN),o=(0,n.GV)((e=>e.server.upgraded),a.bN),d=(0,n.GV)((e=>e.authData.guest),a.bN),{data:g,refetch:u,isLoading:h}=(0,i.xI)(void 0,{refetchOnMountOrArgChange:e,skip:d}),[p,{isLoading:b,isSuccess:x}]=(0,i._8)(),[f,{isSuccess:m,isLoading:w,reset:k}]=(0,i.bb)();(0,c.useEffect)((()=>{m&&(u(),k())}),[m]);const _=null!==(s=null===g||void 0===g?void 0:g.user_limit)&&void 0!==s?s:Number.MAX_SAFE_INTEGER;return(0,c.useEffect)((()=>{_>20&&t((0,r.CI)({upgraded:!0}))}),[_]),{upgraded:o,reachLimit:l>=_,license:g,checked:x,isLoading:h,checking:b,upserting:w,upserted:m,checkLicense:e=>{p(e)},upsertLicense:async e=>{const s=await p(e);return!(!("data"in s)||!s.data.sign)&&await f(e)}}}},99278:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var c=t(26634),i=t(64131),n=t(25293),a=t(79574),r=t(83051),l=t(13370),o=t(77338),d=t(82979);const g=({code:e,from:s="webapp"})=>{const{t:t}=(0,a.Bd)("auth"),{t:c}=(0,a.Bd)(),g=(0,i.useRef)(!1),[u,{isLoading:h,isSuccess:p,error:b}]=(0,l._L)();(0,i.useEffect)((()=>{if(e&&!g.current&&!h&&!p){const s=localStorage.getItem(r.wi);g.current=!0,u({magic_token:s,code:e,type:"github"})}}),[e,u,h,p]),(0,i.useEffect)((()=>{(p||"webapp"==s)&&(n.Ay.success(c("tip.login")),"widget"===s&&localStorage.setItem("widget",`${(new Date).getTime()}`),"webapp"===s&&(location.href="/"))}),[p,s,c]);return(0,d.jsxs)("section",{className:"flex-center flex-col gap-3",children:[(0,d.jsx)(o.A,{onClick:()=>{window.close()},children:c("action.close")}),p&&"widget"===s&&(0,d.jsx)("h1",{children:t("github_cb_tip")}),(0,d.jsx)("span",{className:"text-3xl text-green-600 font-bold",children:t(h?"github_logging_in":"github_login_success")})]})};var u=t(75111),h=t(33162);const p=({sid:e})=>{const{t:s}=(0,a.Bd)("setting",{keyPrefix:"license"}),t=(0,c.Zp)(),{upsertLicense:n,upserting:r,upserted:l}=(0,h.A)(),[g,{data:p,isError:b,isLoading:x,isSuccess:f}]=(0,u.Am)();(0,i.useEffect)((()=>{e&&g(e)}),[e]),(0,i.useEffect)((()=>{if(f&&p){const e=p.license;n(e)}}),[p,f]);return(0,d.jsxs)("section",{className:"flex flex-col items-center bg-slate-100 dark:bg-slate-800 rounded-2xl w-4/5 md:w-[512px] p-6",children:[(0,d.jsx)("img",{className:"w-28 h-28",src:"https://s.voce.chat/web_client/assets/img/check.png",alt:"check icon"}),(0,d.jsx)("h1",{className:"font-bold text-3xl pt-5",children:s("payment_success")}),(0,d.jsxs)("p",{className:"text-lg pb-7 mt-2 text-gray-400 dark:text-gray-600",children:[r?s("tip_renewing"):"",l?s("tip_renewed"):"",b?s("tip_renew_error"):""]}),(0,d.jsx)(o.A,{disabled:x||r,className:"back",onClick:()=>{t("/")},children:s("back_home")})]})},b=({children:e})=>(0,d.jsx)("div",{className:"flex-center dark:bg-gray-700 dark:text-white w-screen h-screen break-words leading-normal",children:e});function x(){const{type:e="",payload:s=""}=(0,c.g)();if("payment_success"==e)return(0,d.jsx)(b,{children:(0,d.jsx)(p,{sid:s})});if("github"==e){var t;const e=null!==(t=new URLSearchParams(location.search).get("code"))&&void 0!==t?t:"";return(0,d.jsx)(b,{children:(0,d.jsx)(g,{code:e,from:s})})}return(0,d.jsx)(b,{children:"callback page"})}}}]);